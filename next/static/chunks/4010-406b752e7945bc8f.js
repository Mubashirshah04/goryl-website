"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4010,5610],{4010:(e,t,o)=>{o.d(t,{C:()=>i,Rg:()=>s,zZ:()=>n});var a=o(35317),r=o(25610);let s=async e=>{try{let t=Object.assign(Object.assign({},e),{status:"pending",submittedAt:(0,a.serverTimestamp)(),createdAt:(0,a.serverTimestamp)()});return(await (0,a.addDoc)((0,a.collection)(r.db,"applications"),t)).id}catch(e){throw console.error("Error submitting application:",e),e}},n=e=>{console.log("\uD83D\uDD0D Admin: Starting to fetch applications from both collections");let t=[],o=[],s=!1,n=!1,i=()=>{if(s&&n){console.log("\uD83D\uDD0D Admin: Combining applications from both collections"),console.log("\uD83D\uDCCA Apps collection: ".concat(t.length," applications")),console.log("\uD83D\uDCCA SellerApps collection: ".concat(o.length," applications"));let a=[...t,...o].filter((e,t,o)=>t===o.findIndex(t=>t.id===e.id));console.log("\uD83D\uDCCA Total unique applications: ".concat(a.length)),e(a)}},l=(0,a.collection)(r.db,"applications"),c=(0,a.query)(l,(0,a.My)("submittedAt","desc")),d=(0,a.onSnapshot)(c,e=>{console.log("\uD83D\uDD0D Admin applications snapshot (apps):",e.docs.length,"documents"),t=[],e.forEach(e=>{var o,a,r;let s=e.data();console.log("\uD83D\uDCC4 Admin application data (apps):",s);let n={id:e.id,userId:s.userId,user:s.user,type:s.type||s.requestedType||"personal_seller",status:s.status,businessName:s.businessName,website:s.website,description:s.description,category:s.category,estimatedRevenue:s.estimatedRevenue||0,location:s.location,documents:(null==(o=s.documents)?void 0:o.map(e=>{var t;return{id:e.id||"doc-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),name:e.name||"Unknown Document",type:e.type||"image",url:e.url||"",uploadedAt:(null==(t=e.uploadedAt)?void 0:t.toDate())||new Date,verified:e.verified||!1}}))||[],notes:s.notes||[],submittedAt:(null==(a=s.submittedAt)?void 0:a.toDate())||new Date,reviewedAt:null==(r=s.reviewedAt)?void 0:r.toDate(),reviewedBy:s.reviewedBy,rejectionReason:s.rejectionReason};t.push(n)}),s=!0,i()},e=>{console.error("Error fetching from applications collection:",e),s=!0,i()}),u=(0,a.collection)(r.db,"sellerApplications"),p=(0,a.query)(u,(0,a.My)("submittedAt","desc")),m=(0,a.onSnapshot)(p,e=>{console.log("\uD83D\uDD0D Admin applications snapshot (sellerApps):",e.docs.length,"documents"),o=[],e.forEach(e=>{var t,a,r;let s=e.data();console.log("\uD83D\uDCC4 Admin application data (sellerApps):",s);let n={id:e.id,userId:s.userId,user:s.user||{id:s.userId,name:s.businessName||"Unknown",email:s.email||"",phone:s.phone||""},type:s.type||s.requestedType||"personal_seller",status:s.status,businessName:s.businessName,website:s.website||"",description:s.businessDescription||s.description||"",category:s.category||"General",estimatedRevenue:s.estimatedRevenue||0,location:s.location||"",documents:(null==(t=s.documents)?void 0:t.map(e=>{var t;return{id:e.id||"".concat(e.name,"-").concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),name:e.name||"Unknown Document",type:e.type||"image",url:e.url||"",uploadedAt:(null==(t=e.uploadedAt)?void 0:t.toDate)?e.uploadedAt.toDate():e.uploadedAt||new Date,verified:e.verified||!1}}))||[],notes:s.notes||[],submittedAt:(null==(a=s.submittedAt)?void 0:a.toDate)?s.submittedAt.toDate():s.submittedAt||new Date,reviewedAt:(null==(r=s.reviewedAt)?void 0:r.toDate)?s.reviewedAt.toDate():s.reviewedAt,reviewedBy:s.reviewedBy,rejectionReason:s.rejectionReason};o.push(n)}),n=!0,i()},e=>{console.error("Error fetching from sellerApplications collection:",e),n=!0,i()});return()=>{d(),m()}},i=async(e,t,s,n)=>{try{let i=(0,a.doc)(r.db,"applications",e),c=await (0,a.x7)(i);if(c.exists()||(console.log("\uD83D\uDD0D Application ".concat(e," not found in 'applications' collection, trying 'sellerApplications'")),i=(0,a.doc)(r.db,"sellerApplications",e),c=await (0,a.x7)(i)),!c.exists())throw console.error("❌ Application ".concat(e," not found in either 'applications' or 'sellerApplications' collections")),Error("Application ".concat(e," not found"));console.log("✅ Application ".concat(e," found in ").concat(c.ref.parent.id," collection"));let d=c.data();console.log("\uD83D\uDD0D Application data for update:",d);let u={status:t,reviewedAt:(0,a.serverTimestamp)(),reviewedBy:s,updatedAt:(0,a.serverTimestamp)()};if(n&&(u.rejectionReason=n,u.notes=[...d.notes||[],"Rejected: ".concat(n)]),await (0,a.mZ)(i,u),"approved"===t){let e=d.type||d.requestedType||d.businessType||"personal";if(console.log("\uD83D\uDD0D Business type for user update:",e),!d.userId)throw console.error("❌ Missing userId in application data:",d),Error("Missing userId in application data");let t=await l(d.userId,e,d.businessName);console.log("✅ Application approved and user ".concat(d.userId," updated to ").concat(t));try{for(let e of[{delay:100},{delay:500},{delay:1500}])setTimeout(async()=>{try{let{useAuthStore:t}=await Promise.resolve().then(o.bind(o,68084));await t.getState().refreshUserData(),console.log("✅ Auth store refresh attempt after ".concat(e.delay,"ms"))}catch(t){console.warn("⚠️ Auth store refresh attempt failed after ".concat(e.delay,"ms:"),t)}},e.delay)}catch(e){console.warn("⚠️ Could not refresh auth store:",e)}}}catch(e){throw console.error("Error updating application status:",e),e}},l=async(e,t,s)=>{try{if(console.log("\uD83D\uDD0D Updating user profile for approval:",{userId:e,businessType:t,businessName:s}),!e)throw Error("User ID is required");if(!t)throw Error("Business type is required");let n=(0,a.doc)(r.db,"users",e),i="user";"personal_seller"===t||"seller"===t||"personal"===t?i="personal_seller":"brand"===t?i="brand":"company"===t?i="company":(console.warn("⚠️ Unknown business type: ".concat(t,", defaulting to personal_seller")),i="personal_seller"),console.log("\uD83D\uDD0D Mapped account type:",i);let l={role:i,accountType:i,isVerifiedSeller:!0,updatedAt:(0,a.serverTimestamp)()};(s||t)&&(l.businessInfo={businessName:s||"",businessType:t}),await (0,a.mZ)(n,l),console.log("✅ User ".concat(e," profile updated to ").concat(i));try{let{useAuthStore:e}=await Promise.resolve().then(o.bind(o,68084));for(let t of[{delay:50},{delay:300},{delay:1e3}])setTimeout(()=>{try{e.getState().refreshUserData(),console.log("✅ Auth store refresh attempt after ".concat(t.delay,"ms"))}catch(e){console.warn("⚠️ Auth store refresh attempt failed after ".concat(t.delay,"ms:"),e)}},t.delay)}catch(e){console.warn("⚠️ Could not refresh auth store:",e)}return i}catch(e){throw console.error("Error updating user profile:",e),e}}},25610:(e,t,o)=>{o.d(t,{db:()=>p,j2:()=>u,storage:()=>m});var a=o(23915),r=o(16203),s=o(35317),n=o(90858),i=o(92144),l=o(81115),c=o(86864);let d=(0,a.Wp)({apiKey:"AIzaSyByhCgo_k9i8_AstSaZkZ3Atv5Rt2eOjhc",authDomain:"zaillisy.firebaseapp.com",databaseURL:"https://zaillisy-default-rtdb.firebaseio.com",projectId:"zaillisy",storageBucket:"zaillisy.firebasestorage.app",messagingSenderId:"984913226421",appId:"1:984913226421:web:c648bbccdd5055cf6cecfc",measurementId:"G-95WJ280TC9"}),u=(0,r.xI)(d),p=(0,s.aU)(d);(0,l.C3)(d);let m=(0,n.c7)(d);(0,i.Uz)(d);try{(0,c.TT)().then(e=>{e?((0,c.P5)(d),console.log("\uD83D\uDCCA Firebase Analytics enabled")):console.log("ℹ️ Firebase Analytics not supported in this environment")}).catch(()=>{console.warn("Analytics check failed; continuing without Analytics")})}catch(e){console.warn("Analytics initialization skipped:",e)}console.log("\uD83D\uDE80 Using production Firebase configuration for project:",d.options.projectId)},68084:(e,t,o)=>{o.d(t,{useAuthStore:()=>i});var a=o(88693),r=o(16203),s=o(25610),n=o(95997);let i=(0,a.vt)((e,t)=>({user:null,userData:null,loading:!0,unsubscribeUserListener:null,setUser:t=>e({user:t}),setUserData:t=>e({userData:t}),setLoading:t=>e({loading:t}),setUnsubscribeUserListener:t=>e({unsubscribeUserListener:t}),initialize:()=>(0,r.hg)(s.j2,async a=>{if(a)try{let r=await (0,n.gL)(a.uid),s=Object.assign(Object.assign({},a),{role:null==r?void 0:r.role});e({user:s,userData:r,loading:!1});let{doc:i,onSnapshot:l}=await Promise.resolve().then(o.bind(o,35317)),{db:c}=await Promise.resolve().then(o.bind(o,25610)),d=i(c,"users",a.uid),u=l(d,o=>{if(o.exists()){let a=o.data();e({userData:a,user:Object.assign(Object.assign({},t().user||{}),{role:a.role})})}});e({unsubscribeUserListener:u})}catch(t){console.error("Error fetching user data:",t),e({user:Object.assign(Object.assign({},a),{role:void 0}),userData:null,loading:!1})}else{let{unsubscribeUserListener:o}=t();o&&(o(),e({unsubscribeUserListener:null})),e({user:null,userData:null,loading:!1})}}),refreshUserData:async()=>{let{user:o}=t();if(o)try{let a=await (0,n.gL)(o.uid);e({userData:a,user:Object.assign(Object.assign({},t().user||{}),{role:null==a?void 0:a.role})}),setTimeout(async()=>{try{let a=await (0,n.gL)(o.uid);e({userData:a,user:Object.assign(Object.assign({},t().user||{}),{role:null==a?void 0:a.role})})}catch(e){console.warn("Error in delayed refresh:",e)}},500)}catch(e){console.error("Error refreshing user data:",e)}}}));setTimeout(()=>{i.getState().initialize()},0)},95997:(e,t,o)=>{o.d(t,{G6:()=>i,HW:()=>u,Hh:()=>c,Jv:()=>l,eT:()=>h,gL:()=>p,qc:()=>g,xw:()=>d});var a=o(16203),r=o(35317),s=o(25610);let n=new a.HF;n.addScope("email"),n.addScope("profile");let i=async()=>{var e;try{let t=(await (0,a.df)(s.j2,n)).user;if(!(await (0,r.x7)((0,r.doc)(s.db,"users",t.uid))).exists()){let o={id:t.uid,email:t.email||"",name:t.displayName||"Anonymous",username:(null==(e=t.email)?void 0:e.split("@")[0])||"user",avatar:t.photoURL||"",role:"user",accountType:"user",isVerified:!1,isVerifiedSeller:!1,isActive:!0,createdAt:new Date,updatedAt:new Date,followersCount:0,followingCount:0,productsCount:0,rating:0,totalSales:0};await (0,r.BN)((0,r.doc)(s.db,"users",t.uid),o)}return t}catch(e){throw console.error("Google sign-in error:",e),e}},l=async(e,t)=>{try{return(await (0,a.x9)(s.j2,e,t)).user}catch(e){throw e}},c=async function(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"user";try{let i=(await (0,a.eJ)(s.j2,e,t)).user;await (0,a.r7)(i,{displayName:o});try{let t={id:i.uid,email:i.email||"",name:o,username:e.split("@")[0],avatar:i.photoURL||"",bio:"",role:n,accountType:n,isVerified:!1,isVerifiedSeller:!1,isActive:!0,createdAt:new Date,updatedAt:new Date,followersCount:0,followingCount:0,productsCount:0,rating:0,totalSales:0};await (0,r.BN)((0,r.doc)(s.db,"users",i.uid),t),console.log("✅ User profile created successfully")}catch(e){console.warn("Could not create user document in Firestore:",e)}return i}catch(e){throw console.error("Signup error:",e),e}},d=async e=>{try{await (0,a.J1)(s.j2,e)}catch(e){throw e}},u=()=>s.j2.currentUser,p=async e=>{try{let t=await (0,r.x7)((0,r.doc)(s.db,"users",e));if(t.exists())return t.data();return null}catch(e){return console.error("Error getting user data:",e),null}},m=async e=>{try{let t=await p(e);return(null==t?void 0:t.role)||"user"}catch(e){return console.error("Error checking user role:",e),"user"}},y=async e=>{try{let t=await p(e);return(null==t?void 0:t.accountType)||"user"}catch(e){return console.error("Error checking account type:",e),"user"}},g=async e=>"admin"===await m(e),h=async e=>["personal_seller","brand","company"].includes(await y(e))}}]);