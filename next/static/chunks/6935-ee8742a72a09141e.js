"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5610,6935],{25610:(e,t,r)=>{r.d(t,{db:()=>g,j2:()=>u,storage:()=>m});var a=r(23915),o=r(16203),i=r(35317),s=r(90858),n=r(92144),l=r(81115),c=r(86864);let d=(0,a.Wp)({apiKey:"AIzaSyByhCgo_k9i8_AstSaZkZ3Atv5Rt2eOjhc",authDomain:"zaillisy.firebaseapp.com",databaseURL:"https://zaillisy-default-rtdb.firebaseio.com",projectId:"zaillisy",storageBucket:"zaillisy.firebasestorage.app",messagingSenderId:"984913226421",appId:"1:984913226421:web:c648bbccdd5055cf6cecfc",measurementId:"G-95WJ280TC9"}),u=(0,o.xI)(d),g=(0,i.aU)(d);(0,l.C3)(d);let m=(0,s.c7)(d);(0,n.Uz)(d);try{(0,c.TT)().then(e=>{e?((0,c.P5)(d),console.log("\uD83D\uDCCA Firebase Analytics enabled")):console.log("ℹ️ Firebase Analytics not supported in this environment")}).catch(()=>{console.warn("Analytics check failed; continuing without Analytics")})}catch(e){console.warn("Analytics initialization skipped:",e)}console.log("\uD83D\uDE80 Using production Firebase configuration for project:",d.options.projectId)},66935:(e,t,r)=>{r.d(t,{x:()=>m});var a=r(88693),o=r(35317),i=r(25610);let s=async e=>{try{let t=(0,o.doc)(i.db,"carts",e),r=await (0,o.x7)(t);if(r.exists())return Object.assign({id:r.id},r.data());return null}catch(e){throw console.error("Error getting user cart:",e),e}},n=async e=>{try{let t=(0,o.doc)(i.db,"carts",e),r=await (0,o.x7)(t);if(r.exists())return Object.assign({id:r.id},r.data());{let r={userId:e,items:[],itemCount:0,subtotal:0,createdAt:(0,o.serverTimestamp)(),updatedAt:(0,o.serverTimestamp)()};return await (0,o.BN)(t,r),Object.assign({id:e},r)}}catch(e){throw console.error("Error getting or creating cart:",e),e}},l=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;try{console.log("Cart service - addToCart called:",{userId:e,product:t,quantity:r});let a=await n(e);console.log("Cart service - Got cart:",a);let s=(0,o.doc)(i.db,"carts",e),l=a.items.findIndex(e=>e.productId===t.id);if(console.log("Cart service - Existing item index:",l),l>=0){let e=[...a.items];e[l].quantity+=r;let t=e.reduce((e,t)=>e+t.quantity*t.product.price,0),i=e.reduce((e,t)=>e+t.quantity,0);await (0,o.mZ)(s,{items:e,itemCount:i,subtotal:t,updatedAt:(0,o.serverTimestamp)()})}else{let i={id:"".concat(Date.now(),"-").concat(Math.random()),userId:e,productId:t.id,product:{id:t.id,title:t.title,image:t.images&&t.images.length>0?t.images[0]:"",price:t.price,stock:t.stock},quantity:r,addedAt:new Date},n=[...a.items,i],l=n.reduce((e,t)=>e+t.quantity*t.product.price,0),c=n.reduce((e,t)=>e+t.quantity,0);await (0,o.mZ)(s,{items:n,itemCount:c,subtotal:l,updatedAt:(0,o.serverTimestamp)()})}}catch(e){throw console.error("Error adding to cart:",e),e}},c=async(e,t,r)=>{try{let a=await s(e);if(!a)throw Error("Cart not found");let n=(0,o.doc)(i.db,"carts",e),l=a.items.map(e=>e.productId===t?Object.assign(Object.assign({},e),{quantity:r}):e),c=l.reduce((e,t)=>e+t.quantity*t.product.price,0),d=l.reduce((e,t)=>e+t.quantity,0);await (0,o.mZ)(n,{items:l,itemCount:d,subtotal:c,updatedAt:(0,o.serverTimestamp)()})}catch(e){throw console.error("Error updating cart item quantity:",e),e}},d=async(e,t)=>{try{let r=await s(e);if(!r)throw Error("Cart not found");let a=(0,o.doc)(i.db,"carts",e),n=r.items.filter(e=>e.productId!==t),l=n.reduce((e,t)=>e+t.quantity*t.product.price,0),c=n.reduce((e,t)=>e+t.quantity,0);await (0,o.mZ)(a,{items:n,itemCount:c,subtotal:l,updatedAt:(0,o.serverTimestamp)()})}catch(e){throw console.error("Error removing from cart:",e),e}},u=async e=>{try{let t=(0,o.doc)(i.db,"carts",e);await (0,o.mZ)(t,{items:[],itemCount:0,subtotal:0,updatedAt:(0,o.serverTimestamp)()})}catch(e){throw console.error("Error clearing cart:",e),e}};var g=r(68084);let m=(0,a.vt)((e,t)=>({cart:null,loading:!1,error:null,setCart:t=>e({cart:t}),setLoading:t=>e({loading:t}),setError:t=>e({error:t}),initializeCart:async r=>{let{cart:a}=t();if(a)return void console.log("Cart already initialized, skipping...");e({loading:!0,error:null});try{e({cart:{id:"temp-".concat(r),userId:r,items:[],itemCount:0,subtotal:0,updatedAt:new Date},loading:!1});let t=await s(r);t&&e({cart:t});let a=((e,t)=>{let r=(0,o.doc)(i.db,"carts",e);return(0,o.onSnapshot)(r,e=>{e.exists()?t(Object.assign({id:e.id},e.data())):t(null)})})(r,t=>{e({cart:t})});window.cartUnsubscribe=a}catch(t){console.error("Error initializing cart:",t),e({error:"Failed to load cart",loading:!1})}},addToCart:async function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,{user:a}=g.useAuthStore.getState();if(console.log("Cart store - addToCart called:",{product:t,quantity:r,user:!!a}),!a){console.log("Cart store - No user found"),e({error:"Please login to add items to cart"});return}e({loading:!0,error:null});try{console.log("Cart store - Calling addToCartService with:",{userId:a.uid,product:t,quantity:r}),await l(a.uid,t,r),console.log("Cart store - Successfully added to cart"),e({loading:!1})}catch(t){console.error("Cart store - Error adding to cart:",t),e({error:"Failed to add item to cart",loading:!1})}},removeFromCart:async t=>{let{user:r}=g.useAuthStore.getState();if(!r)return void e({error:"Please login to remove items from cart"});e({loading:!0,error:null});try{await d(r.uid,t),e({loading:!1})}catch(t){console.error("Error removing from cart:",t),e({error:"Failed to remove item from cart",loading:!1})}},updateQuantity:async(r,a)=>{let{user:o}=g.useAuthStore.getState();if(!o)return void e({error:"Please login to update cart"});if(a<=0)return void await t().removeFromCart(r);e({loading:!0,error:null});try{await c(o.uid,r,a),e({loading:!1})}catch(t){console.error("Error updating cart quantity:",t),e({error:"Failed to update quantity",loading:!1})}},clearCart:async()=>{let{user:t}=g.useAuthStore.getState();if(!t)return void e({error:"Please login to clear cart"});e({loading:!0,error:null});try{await u(t.uid),e({loading:!1})}catch(t){console.error("Error clearing cart:",t),e({error:"Failed to clear cart",loading:!1})}},getCartItemCount:()=>{var e;let{cart:r}=t();return(null==(e=null==r?void 0:r.items)?void 0:e.length)||0},getCartTotal:()=>{let{cart:e}=t();return(null==e?void 0:e.subtotal)||0}}))},68084:(e,t,r)=>{r.d(t,{useAuthStore:()=>n});var a=r(88693),o=r(16203),i=r(25610),s=r(95997);let n=(0,a.vt)((e,t)=>({user:null,userData:null,loading:!0,unsubscribeUserListener:null,setUser:t=>e({user:t}),setUserData:t=>e({userData:t}),setLoading:t=>e({loading:t}),setUnsubscribeUserListener:t=>e({unsubscribeUserListener:t}),initialize:()=>(0,o.hg)(i.j2,async a=>{if(a)try{let o=await (0,s.gL)(a.uid),i=Object.assign(Object.assign({},a),{role:null==o?void 0:o.role});e({user:i,userData:o,loading:!1});let{doc:n,onSnapshot:l}=await Promise.resolve().then(r.bind(r,35317)),{db:c}=await Promise.resolve().then(r.bind(r,25610)),d=n(c,"users",a.uid),u=l(d,r=>{if(r.exists()){let a=r.data();e({userData:a,user:Object.assign(Object.assign({},t().user||{}),{role:a.role})})}});e({unsubscribeUserListener:u})}catch(t){console.error("Error fetching user data:",t),e({user:Object.assign(Object.assign({},a),{role:void 0}),userData:null,loading:!1})}else{let{unsubscribeUserListener:r}=t();r&&(r(),e({unsubscribeUserListener:null})),e({user:null,userData:null,loading:!1})}}),refreshUserData:async()=>{let{user:r}=t();if(r)try{let a=await (0,s.gL)(r.uid);e({userData:a,user:Object.assign(Object.assign({},t().user||{}),{role:null==a?void 0:a.role})}),setTimeout(async()=>{try{let a=await (0,s.gL)(r.uid);e({userData:a,user:Object.assign(Object.assign({},t().user||{}),{role:null==a?void 0:a.role})})}catch(e){console.warn("Error in delayed refresh:",e)}},500)}catch(e){console.error("Error refreshing user data:",e)}}}));setTimeout(()=>{n.getState().initialize()},0)},95997:(e,t,r)=>{r.d(t,{G6:()=>n,HW:()=>u,Hh:()=>c,Jv:()=>l,eT:()=>h,gL:()=>g,qc:()=>p,xw:()=>d});var a=r(16203),o=r(35317),i=r(25610);let s=new a.HF;s.addScope("email"),s.addScope("profile");let n=async()=>{var e;try{let t=(await (0,a.df)(i.j2,s)).user;if(!(await (0,o.x7)((0,o.doc)(i.db,"users",t.uid))).exists()){let r={id:t.uid,email:t.email||"",name:t.displayName||"Anonymous",username:(null==(e=t.email)?void 0:e.split("@")[0])||"user",avatar:t.photoURL||"",role:"user",accountType:"user",isVerified:!1,isVerifiedSeller:!1,isActive:!0,createdAt:new Date,updatedAt:new Date,followersCount:0,followingCount:0,productsCount:0,rating:0,totalSales:0};await (0,o.BN)((0,o.doc)(i.db,"users",t.uid),r)}return t}catch(e){throw console.error("Google sign-in error:",e),e}},l=async(e,t)=>{try{return(await (0,a.x9)(i.j2,e,t)).user}catch(e){throw e}},c=async function(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"user";try{let n=(await (0,a.eJ)(i.j2,e,t)).user;await (0,a.r7)(n,{displayName:r});try{let t={id:n.uid,email:n.email||"",name:r,username:e.split("@")[0],avatar:n.photoURL||"",bio:"",role:s,accountType:s,isVerified:!1,isVerifiedSeller:!1,isActive:!0,createdAt:new Date,updatedAt:new Date,followersCount:0,followingCount:0,productsCount:0,rating:0,totalSales:0};await (0,o.BN)((0,o.doc)(i.db,"users",n.uid),t),console.log("✅ User profile created successfully")}catch(e){console.warn("Could not create user document in Firestore:",e)}return n}catch(e){throw console.error("Signup error:",e),e}},d=async e=>{try{await (0,a.J1)(i.j2,e)}catch(e){throw e}},u=()=>i.j2.currentUser,g=async e=>{try{let t=await (0,o.x7)((0,o.doc)(i.db,"users",e));if(t.exists())return t.data();return null}catch(e){return console.error("Error getting user data:",e),null}},m=async e=>{try{let t=await g(e);return(null==t?void 0:t.role)||"user"}catch(e){return console.error("Error checking user role:",e),"user"}},y=async e=>{try{let t=await g(e);return(null==t?void 0:t.accountType)||"user"}catch(e){return console.error("Error checking account type:",e),"user"}},p=async e=>"admin"===await m(e),h=async e=>["personal_seller","brand","company"].includes(await y(e))}}]);