"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4978],{8813:(e,r,t)=>{t.d(r,{I_:()=>u,TV:()=>h,createProduct:()=>l,d$:()=>n,deleteProduct:()=>d,oo:()=>c,updateProduct:()=>i,vC:()=>p});var a=t(35317),s=t(25610),o=t(95997);let l=async e=>{try{if(!await (0,o.eT)(e.sellerId))throw Error("Only approved sellers can create products");let r={id:e.sellerId,name:e.sellerName||"",type:"personal"};try{let t=await (0,a.x7)((0,a.doc)(s.db,"users",e.sellerId));if(t.exists()){let a=t.data();r={id:a.id||e.sellerId,name:a.name||e.sellerName||"",type:a.sellerType||a.role||"personal"}}}catch(e){console.warn("Could not fetch seller info for product creation:",e)}return(await (0,a.addDoc)((0,a.collection)(s.db,"products"),Object.assign(Object.assign({},e),{seller:r,sellerRef:{id:r.id,name:r.name,photoURL:""},likes:[],views:0,rating:0,reviewCount:0,comments:0,status:"active",createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()}))).id}catch(e){throw console.error("Error creating product:",e),e}},c=async e=>{try{let r=(0,a.doc)(s.db,"products",e),t=await (0,a.x7)(r);if(t.exists()){let e=Object.assign({id:t.id},t.data());if(e.sellerId)try{let r=await (0,a.x7)((0,a.doc)(s.db,"users",e.sellerId));if(r.exists()){let t=r.data();e.seller={id:t.id,name:t.name,avatar:t.avatar,isVerified:t.isVerified,rating:t.rating}}}catch(e){console.warn("Could not fetch seller information:",e)}return e}return null}catch(e){throw console.error("Error getting product:",e),e}},i=async(e,r)=>{try{let t=(0,a.doc)(s.db,"products",e);await (0,a.mZ)(t,Object.assign(Object.assign({},r),{updatedAt:(0,a.serverTimestamp)()}))}catch(e){throw console.error("Error updating product:",e),e}},d=async e=>{try{let r=(0,a.doc)(s.db,"products",e);await (0,a.kd)(r)}catch(e){throw console.error("Error deleting product:",e),e}},n=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"createdAt",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;try{let l=(0,a.collection)(s.db,"products"),c=[];e.category&&c.push({field:"category",operator:"==",value:e.category}),e.sellerId&&c.push({field:"sellerId",operator:"==",value:e.sellerId}),e.status?c.push({field:"status",operator:"==",value:e.status}):c.push({field:"status",operator:"==",value:"active"}),void 0!==e.minPrice&&c.push({field:"price",operator:">=",value:e.minPrice}),void 0!==e.maxPrice&&c.push({field:"price",operator:"<=",value:e.maxPrice}),c.forEach(e=>{l=(0,a.query)(l,(0,a.where)(e.field,e.operator,e.value))}),l=(0,a.query)(l,(0,a.My)(r,t)),l=(0,a.query)(l,(0,a.AB)(o));let i=(await (0,a.getDocs)(l)).docs.map(e=>Object.assign({id:e.id},e.data()));if(e.search){let r=e.search.toLowerCase();i=i.filter(e=>{var t;return e.title.toLowerCase().includes(r)||e.description.toLowerCase().includes(r)||(null==(t=e.brand)?void 0:t.toLowerCase().includes(r))})}let d=[...new Set(i.map(e=>e.sellerId))],n=new Map;for(let e of d)try{let r=await (0,a.x7)((0,a.doc)(s.db,"users",e));r.exists()&&n.set(e,r.data())}catch(r){console.warn("Could not fetch seller ".concat(e,":"),r)}return i.map(e=>{let r=n.get(e.sellerId);return r&&(e.seller={id:r.id,name:r.name,avatar:r.avatar,isVerified:r.isVerified,rating:r.rating}),e})}catch(e){return console.log("Firebase products not accessible, returning empty array"),[]}},u=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"createdAt",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"desc",l=(0,a.collection)(s.db,"products"),c=[];return r.category&&c.push({field:"category",operator:"==",value:r.category}),r.sellerId&&c.push({field:"sellerId",operator:"==",value:r.sellerId}),r.status&&c.push({field:"status",operator:"==",value:r.status}),void 0!==r.minPrice&&c.push({field:"price",operator:">=",value:r.minPrice}),void 0!==r.maxPrice&&c.push({field:"price",operator:"<=",value:r.maxPrice}),c.forEach(e=>{l=(0,a.query)(l,(0,a.where)(e.field,e.operator,e.value))}),l=(0,a.query)(l,(0,a.My)(t,o)),(0,a.onSnapshot)(l,async t=>{console.log("Products found:",t.docs.length);let o=t.docs.map(e=>Object.assign({id:e.id},e.data()));if(r.search){let e=r.search.toLowerCase();o=o.filter(r=>{var t;return r.title.toLowerCase().includes(e)||r.description.toLowerCase().includes(e)||(null==(t=r.brand)?void 0:t.toLowerCase().includes(e))})}let l=[...new Set(o.map(e=>e.sellerId))],c=new Map;for(let e of l)try{let r=await (0,a.x7)((0,a.doc)(s.db,"users",e));r.exists()&&c.set(e,r.data())}catch(r){console.warn("Could not fetch seller ".concat(e,":"),r)}e(o.map(e=>{let r=c.get(e.sellerId);return r&&(e.seller={id:r.id,name:r.name,avatar:r.avatar,isVerified:r.isVerified,rating:r.rating}),e}))},r=>{console.error("Firestore error:",r.message),e([])})},p=async(e,r)=>{try{let t=await c(e);if(!t)throw Error("Product not found");let a=t.likes||[];a.includes(r)?await i(e,{likes:a.filter(e=>e!==r)}):await i(e,{likes:[...a,r]})}catch(e){throw console.error("Error toggling product like:",e),e}},h=async e=>n({sellerId:e})},29415:(e,r,t)=>{t.d(r,{H:()=>i,K:()=>n,Qk:()=>l,Yn:()=>u,gx:()=>p,mQ:()=>m,pX:()=>h,vf:()=>o,vv:()=>d,zT:()=>c});var a=t(35317),s=t(25610);let o=async e=>{try{return(await (0,a.addDoc)((0,a.collection)(s.db,"reels"),Object.assign(Object.assign({},e),{likesCount:0,commentsCount:0,sharesCount:0,viewsCount:0,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()}))).id}catch(e){throw console.error("Error creating reel:",e),e}},l=async(e,r)=>{try{let t=(0,a.doc)(s.db,"reels",e);await (0,a.mZ)(t,{likesCount:(0,a.GV)(1),likedBy:(0,a.hq)(r),updatedAt:(0,a.serverTimestamp)()})}catch(e){throw console.error("Error liking reel:",e),e}},c=async(e,r)=>{try{let t=(0,a.doc)(s.db,"reels",e);await (0,a.mZ)(t,{likesCount:(0,a.GV)(-1),likedBy:(0,a.C3)(r),updatedAt:(0,a.serverTimestamp)()})}catch(e){throw console.error("Error unliking reel:",e),e}},i=e=>{let r=(0,a.query)((0,a.collection)(s.db,"reels"),(0,a.My)("createdAt","desc"));return(0,a.onSnapshot)(r,r=>{e(r.docs.map(e=>Object.assign({id:e.id},e.data())))},r=>{console.log("Reels not accessible, returning empty array"),e([])})},d=async(e,r,t,o,l)=>{try{let c=await (0,a.addDoc)((0,a.collection)(s.db,"reels",e,"comments"),{userId:r,userName:t,userPhotoURL:o,text:l,content:l,likesCount:0,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()}),i=(0,a.doc)(s.db,"reels",e);return await (0,a.mZ)(i,{commentsCount:(0,a.GV)(1),updatedAt:(0,a.serverTimestamp)()}),c.id}catch(e){throw console.error("Error adding reel comment:",e),e}},n=(e,r)=>{let t=(0,a.query)((0,a.collection)(s.db,"reels",e,"comments"),(0,a.My)("createdAt","desc"));return(0,a.onSnapshot)(t,e=>{r(e.docs.map(e=>{let r=e.data();return{id:e.id,userId:r.userId,userName:r.userName,userPhotoURL:r.userPhotoURL||r.userPhoto,text:r.text||r.content,likesCount:r.likesCount||0,createdAt:r.createdAt,updatedAt:r.updatedAt}}))},e=>{console.log("Reel comments not accessible, returning empty array"),r([])})},u=async(e,r)=>{try{let t=(0,a.doc)(s.db,"reels",e);await (0,a.mZ)(t,{sharesCount:(0,a.GV)(1),sharedBy:(0,a.hq)(r),updatedAt:(0,a.serverTimestamp)()})}catch(e){throw console.error("Error sharing reel:",e),e}},p=async(e,r)=>{try{let t=(0,a.doc)(s.db,"users",r,"savedReels",e);await (0,a.BN)(t,{reelId:e,savedAt:(0,a.serverTimestamp)()})}catch(e){throw console.error("Error saving reel:",e),e}},h=async(e,r)=>{try{let t=(0,a.doc)(s.db,"users",r,"savedReels",e);await (0,a.kd)(t)}catch(e){throw console.error("Error unsaving reel:",e),e}},m=async(e,r)=>{try{let t=(0,a.doc)(s.db,"users",r,"savedReels",e);return(await (0,a.x7)(t)).exists()}catch(e){return console.error("Error checking if reel is saved:",e),!1}}},84616:(e,r,t)=>{t.d(r,{A:()=>a});let a=(0,t(19946).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])}}]);