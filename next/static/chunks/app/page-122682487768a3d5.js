(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{1740:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>b});var s=t(95155),o=t(12115);t(35317),t(25610);var i=t(68084),l=t(66935),a=t(33681),n=t(1978),d=t(56671),c=t(6874),u=t.n(c),m=t(8813),h=t(11518),g=t.n(h),f=t(35695),p=t(98868),y=t(81875),x=t(62525),v=t(44020);function w(){let{user:e,loading:r}=(0,i.useAuthStore)(),{profile:t}=(0,p.n)(),l=(0,f.useRouter)(),[a,c]=(0,o.useState)([]),[u,m]=(0,o.useState)(!0),[h,w]=(0,o.useState)({isOpen:!1,stories:[],currentIndex:0}),b=(0,o.useRef)(!1),[j,N]=(0,o.useState)(null),A=(0,o.useRef)(null),k=(0,o.useRef)(!0),E=(0,o.useCallback)(()=>t?t.customPhotoURL||t.photoURL||t.profilePic||t.avatar||(null==e?void 0:e.photoURL)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(encodeURIComponent(t.name||(null==e?void 0:e.displayName)||"user")):(null==e?void 0:e.photoURL)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(encodeURIComponent((null==e?void 0:e.displayName)||(null==e?void 0:e.email)||"user")),[t,e]),S=(0,o.useCallback)((r,s,o)=>e&&r===e.uid&&t?E():s||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(encodeURIComponent(o||"user")),[e,t,E]);(0,o.useEffect)(()=>{if(e&&a.length>0){let r=E();c(t=>{let s=[...t],o=s.findIndex(e=>e.isOwnStory);if(-1!==o&&s[o].userPhoto!==r)return s[o]={...s[o],userPhoto:r},s;let i=!1,l=s.map(t=>t.userId!==e.uid||t.isOwnStory||t.userPhoto===r?t:(i=!0,{...t,userPhoto:r}));return i?l:t})}},[null==t?void 0:t.customPhotoURL,null==t?void 0:t.photoURL,null==t?void 0:t.profilePic,null==t?void 0:t.avatar,null==e?void 0:e.uid,a.length]),console.log("StoriesSection rendered, user:",null==e?void 0:e.uid,"authLoading:",r);let P=(0,o.useCallback)(async()=>{if(k.current){0===a.length&&m(!0);try{let r=setTimeout(()=>{k.current&&m(!1)},3e3),t=await (0,y.dU)();if(clearTimeout(r),!k.current)return;let s=t.map(r=>({...r,isViewed:!!e&&r.views.includes(e.uid),isOwnStory:!1}));if(e){let r={id:"own-story",userId:e.uid,userName:"Your story",userPhoto:E(),storyImage:"",storyImagePath:"",storyVideo:"",storyVideoPath:"",mediaType:"image",privacy:"public",createdAt:new Date,expiresAt:new Date,views:[],isActive:!0,isViewed:!1,isOwnStory:!0};c(e=>{let t=[r,...s];return JSON.stringify(e)!==JSON.stringify(t)?t:e})}else c(e=>JSON.stringify(e)!==JSON.stringify(s)?s:e);console.log("Stories loaded successfully:",s.length)}catch(r){if(console.error("Error loading stories:",r),e&&k.current){let r={id:"own-story",userId:e.uid,userName:"Your story",userPhoto:E(),storyImage:"",storyImagePath:"",storyVideo:"",storyVideoPath:"",mediaType:"image",privacy:"public",createdAt:new Date,expiresAt:new Date,views:[],isActive:!0,isViewed:!1,isOwnStory:!0};c(e=>JSON.stringify(e)!==JSON.stringify([r])?[r]:e)}else k.current&&c(e=>e.length>0?[]:e)}finally{k.current&&m(!1)}}},[e,E,a.length]);(0,o.useEffect)(()=>(k.current=!0,P(),A.current||(console.log("Setting up real-time stories listener"),A.current=(0,y.pt)(r=>{if(!k.current)return;let t=r.map(r=>({...r,isViewed:!!e&&r.views.includes(e.uid),isOwnStory:!1}));if(e){let r={id:"own-story",userId:e.uid,userName:"Your story",userPhoto:E(),storyImage:"",storyImagePath:"",storyVideo:"",storyVideoPath:"",mediaType:"image",privacy:"public",createdAt:new Date,expiresAt:new Date,views:[],isActive:!0,isViewed:!1,isOwnStory:!0};c(e=>{let s=[r,...t];return JSON.stringify(e)!==JSON.stringify(s)?s:e})}else c(e=>JSON.stringify(e)!==JSON.stringify(t)?t:e);console.log("Stories updated via real-time listener:",t.length)})),()=>{k.current=!1,A.current&&(console.log("Cleaning up stories listener"),A.current(),A.current=null)}),[e,P,null==E?void 0:E()]);let I=async t=>(console.log("Story clicked:",t.isOwnStory,"user:",null==e?void 0:e.uid,"authLoading:",r),r)?void console.log("Auth still loading, ignoring click"):h.isOpen?void console.log("Story viewer already open, ignoring click to prevent multiple frames"):void(t.isOwnStory?(console.log("Navigating to upload/story"),l.push("/upload/story")):O(t)),R=async r=>{if(!e)return void d.oR.error("You must be logged in to delete stories");try{await (0,y.RZ)(r,e.uid),c(e=>e.filter(e=>e.id!==r)),N(null),d.oR.success("Story deleted successfully!")}catch(e){console.error("Error deleting story:",e),d.oR.error("Failed to delete story")}},O=r=>{if(b.current)return void console.log("\uD83D\uDEAB BLOCKED BY REF: Story viewer already open");if(document.getElementById("instagram-story-viewer"))return void console.log("\uD83D\uDEAB Viewer already exists in DOM");b.current=!0,console.log("=== OPENING SINGLE STORY VIEWER ==="),console.log("Story image URL:",r.storyImage),console.log("Story media type:",r.mediaType),console.log("========================"),e&&!r.isViewed&&((0,y.F_)(r.id,e.uid).catch(console.error),c(e=>e.map(e=>e.id===r.id?{...e,isViewed:!0}:e)));let t=a.filter(e=>!e.isOwnStory),s=[...t.filter(e=>e.userId===r.userId),...t.filter(e=>e.userId!==r.userId)],o=s.findIndex(e=>e.id===r.id);if(0===s.length){console.log("No stories available to view"),b.current=!1;return}if(console.log("Opening Instagram viewer: Story ".concat(o+1," of ").concat(s.length)),h.isOpen){console.log("\uD83D\uDEAB Viewer already open in state, updating index only"),w(e=>({...e,currentIndex:o,stories:s}));return}w({isOpen:!0,stories:s,currentIndex:o}),console.log("✅ Story viewer opened successfully")},C=e=>{let{story:r,onDelete:t,isVisible:o,onClose:i}=e;return o?(0,s.jsx)("div",{className:"absolute top-8 right-0 z-50 bg-white/20 backdrop-blur-xl border border-white/30 rounded-2xl shadow-2xl min-w-[150px] overflow-hidden",children:(0,s.jsx)("div",{className:"py-2",children:(0,s.jsxs)("button",{onClick:()=>{t(r.id),i()},className:"w-full px-4 py-3 text-left text-red-400 hover:bg-red-500/20 hover:text-red-300 transition-all duration-200 flex items-center space-x-2",children:[(0,s.jsx)(x.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Delete Story"})]})})}):null};if(u&&0===a.length)return(0,s.jsx)("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-white/10 py-6 shadow-sm",children:(0,s.jsxs)("div",{className:"container mx-auto px-4",children:[(0,s.jsx)("div",{className:"flex space-x-6 overflow-x-auto scrollbar-hide pb-2",children:[void 0,void 0,void 0].map((e,r)=>(0,s.jsxs)(n.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.1*r},className:"flex-shrink-0 text-center",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 animate-pulse shadow-lg",children:(0,s.jsx)("div",{className:"w-full h-full rounded-full bg-white dark:bg-gray-800 p-1 m-1",children:(0,s.jsx)("div",{className:"w-full h-full rounded-full bg-gray-200 dark:bg-gray-700 animate-pulse"})})}),(0,s.jsx)("div",{className:"absolute -bottom-1 -right-1 w-7 h-7 bg-gray-300 dark:bg-gray-600 rounded-full animate-pulse"})]}),(0,s.jsx)("div",{className:"w-16 h-3 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded-full animate-pulse mt-2 mx-auto"})]},r))}),(0,s.jsx)("div",{className:"mt-4 h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-700 to-transparent"})]})});let U=a.filter(e=>!e.isOwnStory),D=a.find(e=>e.isOwnStory);return(console.log("Displaying stories:",a.length),console.log("Actual uploaded stories:",U.length),console.log("User logged in:",!!e),console.log("User ID:",null==e?void 0:e.uid),0!==a.length||e)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-white/10 py-6 shadow-sm",children:(0,s.jsxs)("div",{className:"container mx-auto px-4",children:[(0,s.jsxs)("div",{className:"flex space-x-6 overflow-x-auto scrollbar-hide pb-2",children:[D&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:0,type:"spring",stiffness:100,damping:15},whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex-shrink-0 text-center cursor-pointer group",onClick:()=>I(D),children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 rounded-full p-1 transition-all duration-300 group-hover:scale-110 bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 border-2 border-dashed border-gray-400 dark:border-gray-500",children:(0,s.jsx)("div",{className:"relative w-full h-full rounded-full bg-white dark:bg-gray-900 p-1 shadow-inner",children:(0,s.jsx)("div",{className:"w-full h-full rounded-full overflow-hidden ring-2 ring-white/50",children:(0,s.jsx)("img",{src:D.userPhoto,alt:D.userName,width:"80",height:"80",className:"w-full h-full object-contain transition-transform duration-300 group-hover:scale-110",referrerPolicy:"no-referrer",onError:e=>{let r=["https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(D.userName),"https://ui-avatars.com/api/?name=".concat(D.userName,"&background=6366f1&color=ffffff"),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg=="];e.currentTarget.src=r[0]}})})})}),(0,s.jsx)(n.P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.3,type:"spring"},className:"absolute -bottom-1 -right-1 w-7 h-7 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center border-3 border-white dark:border-gray-900 shadow-lg",children:(0,s.jsx)(n.P.svg,{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",whileHover:{rotate:90},transition:{duration:.2},children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})})}),(0,s.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-purple-500/20 to-pink-500/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]}),(0,s.jsx)(n.P.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mt-2 max-w-[70px] sm:max-w-[90px] truncate group-hover:text-purple-600 transition-colors duration-200",children:D.userName})]},D.id),U.map((r,t)=>{var o;let i=U.filter(e=>e.userId===r.userId),l=i.length>1,a=(null==(o=i[0])?void 0:o.id)===r.id;return l&&!a?null:(0,s.jsxs)(n.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:(D?t+1:t)*.05,type:"spring",stiffness:100,damping:15},whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex-shrink-0 text-center cursor-pointer group",onClick:()=>I(r),children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"relative w-20 h-20 sm:w-24 sm:h-24 rounded-full p-1 transition-all duration-300 group-hover:scale-110 ".concat(r.isViewed?"bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-700 dark:to-gray-600":"bg-gradient-to-br from-purple-500 via-pink-500 to-orange-500 shadow-lg shadow-purple-500/30"),children:[!r.isViewed&&(0,s.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 blur-sm opacity-60 animate-pulse"}),l&&(0,s.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center border-2 border-white dark:border-gray-900",children:(0,s.jsx)("span",{className:"text-white text-xs font-bold",children:i.length})}),(0,s.jsx)("div",{className:"relative w-full h-full rounded-full bg-white dark:bg-gray-900 p-1 shadow-inner",children:(0,s.jsx)("div",{className:"w-full h-full rounded-full overflow-hidden ring-2 ring-white/50",children:(0,s.jsx)("img",{src:S(r.userId,r.userPhoto,r.userName),alt:r.userName,width:"80",height:"80",className:"w-full h-full object-contain transition-transform duration-300 group-hover:scale-110",onError:e=>{let t=["https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(r.userName),"https://ui-avatars.com/api/?name=".concat(r.userName,"&background=6366f1&color=ffffff"),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg=="];e.currentTarget.src=t[0]}})})}),e&&r.userId===e.uid&&(0,s.jsx)(n.P.button,{initial:{scale:0},animate:{scale:1},transition:{delay:.3},onClick:e=>{e.stopPropagation(),N(j===r.id?null:r.id)},className:"absolute -top-1 -right-1 w-6 h-6 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center border border-gray-200 shadow-lg hover:bg-white hover:scale-110 transition-all duration-200 z-10",children:(0,s.jsx)(v.A,{className:"w-3 h-3 text-gray-600"})}),e&&r.userId===e.uid&&(0,s.jsx)(C,{story:r,onDelete:R,isVisible:j===r.id,onClose:()=>N(null)})]}),!r.isViewed&&(0,s.jsxs)(n.P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2},className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-br from-red-500 to-red-600 rounded-full border-3 border-white dark:border-gray-900 shadow-lg",children:[(0,s.jsx)("div",{className:"w-full h-full rounded-full bg-red-500 animate-pulse"}),(0,s.jsx)("div",{className:"absolute inset-0 rounded-full bg-red-400 blur-sm opacity-50 animate-ping"})]}),(0,s.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-purple-500/20 to-pink-500/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]}),(0,s.jsx)(n.P.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4+(D?t+1:t)*.05},className:"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mt-2 max-w-[70px] sm:max-w-[90px] truncate group-hover:text-purple-600 transition-colors duration-200",children:r.userName})]},r.id)})]}),(0,s.jsx)("div",{className:"mt-4 h-px bg-gradient-to-r from-transparent via-purple-200 dark:via-purple-900 to-transparent"})]})}),h.isOpen&&(0,s.jsx)(()=>{console.log("\uD83C\uDFA5 Instagram Story Viewer RENDERED"),(0,o.useEffect)(()=>{let e=document.querySelectorAll(".story-viewer-backdrop");if(e.length>1){console.log("⚠️ Duplicate viewers found, removing extras");for(let r=1;r<e.length;r++)e[r].remove()}},[]);let[e,r]=(0,o.useState)(h.currentIndex),[t,i]=(0,o.useState)(!1),[l,a]=(0,o.useState)(0),[n,d]=(0,o.useState)(null),c=(0,o.useRef)(null),u=h.stories[e];(0,o.useEffect)(()=>{i(!1),a(0),d(null),setTimeout(()=>{let e=document.querySelectorAll('[style*="transition"]'),r=h.stories.filter(e=>e.userId===u.userId).findIndex(e=>e.id===u.id);e.forEach((e,t)=>{e instanceof HTMLElement&&(e.style.transition="none",e.style.width=t<r?"100%":"0%",e.offsetWidth)}),(null==u?void 0:u.mediaType)!=="video"&&setTimeout(()=>{e.forEach((e,t)=>{e instanceof HTMLElement&&t===r&&(e.style.transition="width 5s linear",e.style.width="100%")})},50)},10)},[e,u,h.stories]),(0,o.useEffect)(()=>{let e;if((null==u?void 0:u.mediaType)!=="video"||!c.current)return;let r=c.current,t=()=>{if(!r.duration)return;let s=r.currentTime/r.duration*100,o=document.querySelectorAll('[style*="transition"]'),i=h.stories.filter(e=>e.userId===u.userId).findIndex(e=>e.id===u.id);o.forEach((e,r)=>{e instanceof HTMLElement&&r===i&&(e.style.transition="none",e.style.width="".concat(s,"%"))}),r.currentTime<r.duration&&(e=requestAnimationFrame(t))},s=()=>{e=requestAnimationFrame(t)},o=()=>{e&&cancelAnimationFrame(e)};return r.addEventListener("play",s),r.addEventListener("pause",o),r.addEventListener("seeking",s),r.paused||(e=requestAnimationFrame(t)),()=>{r.removeEventListener("play",s),r.removeEventListener("pause",o),r.removeEventListener("seeking",s),e&&cancelAnimationFrame(e)}},[u,h.stories]),(0,o.useEffect)(()=>{if(h.isOpen){document.body.classList.add("story-viewer-open"),document.body.style.overflow="hidden";let e=document.querySelectorAll(".story-viewer-backdrop");if(e.length>1){console.log("⚠️ Multiple viewers detected, removing duplicates");for(let r=1;r<e.length;r++)e[r].remove()}document.querySelectorAll(".story-viewer-backdrop").forEach((e,r)=>{r>0&&e.remove()})}else document.body.classList.remove("story-viewer-open"),document.body.style.overflow="";return()=>{document.body.classList.remove("story-viewer-open"),document.body.style.overflow=""}},[h.isOpen]),(0,o.useEffect)(()=>(console.log("\uD83D\uDD04 Story Viewer mounted with",h.stories.length,"stories"),()=>{console.log("\uD83D\uDDFD Story Viewer unmounted"),b.current=!1}),[]);let m=()=>{console.log("❌ Closing story viewer manually"),b.current=!1,w({isOpen:!1,stories:[],currentIndex:0})},f=()=>{console.log("⬅️ Previous story: ".concat(e-1,"/").concat(h.stories.length)),e>0&&(r(e-1),i(!1),a(0))},p=()=>{console.log("➡️ Next story: ".concat(e+1,"/").concat(h.stories.length)),e<h.stories.length-1?(r(e+1),i(!1),a(0)):(console.log("\uD83C\uDFC1 End of stories reached, closing viewer"),b.current=!1,w({isOpen:!1,stories:[],currentIndex:0}))};if((0,o.useEffect)(()=>{let e=e=>{"ArrowRight"===e.key||" "===e.key?(e.preventDefault(),p()):"ArrowLeft"===e.key?(e.preventDefault(),f()):"Escape"===e.key&&m()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[e]),(0,o.useEffect)(()=>{let e=null;return(null==u?void 0:u.mediaType)==="video"?()=>{}:(e=setTimeout(p,5e3),setTimeout(()=>{let e=document.querySelectorAll('[style*="transition"]'),r=h.stories.filter(e=>e.userId===u.userId).findIndex(e=>e.id===u.id);e.forEach((e,t)=>{e instanceof HTMLElement&&t===r&&(e.style.transition="width 5s linear",e.style.width="100%")})},50),()=>{e&&clearTimeout(e)})},[e,u,t]),!u)return null;let y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==",x=["https://via.placeholder.com/400x600/6366f1/ffffff?text=Story+Image","https://placehold.co/400x600/6366f1/ffffff?text=Story+Image",y],v=["https://via.placeholder.com/400x600/6366f1/ffffff?text=Story+Video","https://placehold.co/400x600/6366f1/ffffff?text=Story+Video",y],j=t||!u.storyImage?x[Math.min(l,x.length-1)]:u.storyImage,N=u.storyVideo?u.storyVideo:v[Math.min(l,v.length-1)];return(0,s.jsxs)("div",{id:"instagram-story-viewer",className:"jsx-ca17cfb9e89386b9 story-viewer-backdrop fixed inset-0 bg-black z-50 flex items-center justify-center",children:[(0,s.jsxs)("div",{className:"jsx-ca17cfb9e89386b9 relative w-full h-full bg-black",children:[(0,s.jsx)("div",{className:"jsx-ca17cfb9e89386b9 absolute top-0 left-0 right-0 z-10 p-2",children:(0,s.jsx)("div",{className:"jsx-ca17cfb9e89386b9 flex space-x-1",children:(()=>{let e=h.stories.filter(e=>e.userId===u.userId),r=e.findIndex(e=>e.id===u.id);return e.map((e,t)=>(0,s.jsx)("div",{className:"flex-1 h-1 bg-gray-600 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-white ".concat(t<r?"w-full":"w-0"),style:{transition:"none",width:t<r?"100%":"0%"}})},t))})()})}),(0,s.jsxs)("div",{className:"jsx-ca17cfb9e89386b9 relative w-full h-full flex items-center justify-center bg-black",children:["video"===u.mediaType?(0,s.jsx)("video",{ref:c,src:N,autoPlay:!0,playsInline:!0,className:"w-full h-full object-contain",onError:()=>{l<v.length-1&&a(e=>e+1)},onLoadedMetadata:()=>{c.current&&d(c.current.duration)},onEnded:p}):(0,s.jsx)("img",{src:j,alt:"Story",className:"w-full h-full object-contain",onError:()=>{l<x.length-1?a(e=>e+1):i(!0)}}),(0,s.jsxs)("div",{className:"jsx-ca17cfb9e89386b9 absolute inset-0 flex",children:[(0,s.jsx)("div",{onClick:f,className:"jsx-ca17cfb9e89386b9 flex-1 cursor-pointer"}),(0,s.jsx)("div",{onClick:p,className:"jsx-ca17cfb9e89386b9 flex-1 cursor-pointer"})]}),(0,s.jsx)("button",{onClick:m,className:"jsx-ca17cfb9e89386b9 absolute top-3 right-2 sm:top-5 sm:right-4 w-8 h-8 sm:w-10 sm:h-10 bg-black bg-opacity-50 rounded-full flex items-center justify-center text-white hover:bg-opacity-70 transition-colors z-20",children:(0,s.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-ca17cfb9e89386b9 w-4 h-4 sm:w-6 sm:h-6",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12",className:"jsx-ca17cfb9e89386b9"})})}),(0,s.jsx)("div",{className:"jsx-ca17cfb9e89386b9 absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-3 sm:p-6",children:(0,s.jsxs)("div",{className:"jsx-ca17cfb9e89386b9 flex items-center space-x-2 sm:space-x-3 mb-2 sm:mb-4",children:[(0,s.jsx)("img",{src:S(u.userId,u.userPhoto,u.userName),alt:u.userName,referrerPolicy:"no-referrer",onError:e=>{let r=["https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(u.userName),"https://ui-avatars.com/api/?name=".concat(u.userName,"&background=6366f1&color=ffffff"),y];e.currentTarget.src=r[0]},className:"jsx-ca17cfb9e89386b9 w-8 h-8 sm:w-10 sm:h-10 rounded-full border-2 border-white"}),(0,s.jsxs)("div",{className:"jsx-ca17cfb9e89386b9",children:[(0,s.jsx)("h3",{className:"jsx-ca17cfb9e89386b9 text-white font-semibold text-sm sm:text-base",children:u.userName}),(0,s.jsxs)("p",{className:"jsx-ca17cfb9e89386b9 text-gray-300 text-xs sm:text-sm",children:[u.views.length," views"]})]})]})})]})]}),(0,s.jsx)(g(),{id:"ca17cfb9e89386b9",children:"@keyframes progress-5s{from{width:0}to{width:100%}}@keyframes progress-15s{from{width:0}to{width:100%}}"})]})},{},"instagram-story-viewer-single-instance")]}):(0,s.jsx)("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-white/10 py-6 shadow-sm",children:(0,s.jsx)("div",{className:"container mx-auto px-4",children:(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCF8"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 mb-2",children:"No Stories Yet"}),(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Login to share your story!"})]})})})}function b(){let[e,r]=(0,o.useState)([]),[t,d]=(0,o.useState)(!0),[c,h]=(0,o.useState)(!1),[g,f]=(0,o.useState)(""),[p,y]=(0,o.useState)(!1),{user:x,userData:v,loading:b}=(0,i.useAuthStore)(),j=[],{addToCart:N,getCartItemCount:A}=(0,l.x)(),{addToWishlist:k,removeFromWishlist:E,isInWishlist:S,wishlist:P}=(0,a.q)();return((0,o.useEffect)(()=>{y(!0)},[]),(0,o.useEffect)(()=>{x&&x.uid&&(l.x.getState().initializeCart(x.uid),a.q.getState().initializeWishlist(x.uid))},[x]),(0,o.useEffect)(()=>{let e;return console.log("\uD83D\uDD0D Checking conditions - authLoading:",b,"recommendationsLoading:",!1),b?console.log("❌ Conditions not met, skipping listener setup"):(console.log("✅ Conditions met, setting up real-time listener"),e&&e(),console.log("\uD83D\uDD27 Setting up real-time products listener..."),e=(0,m.I_)(e=>{console.log("\uD83D\uDCF1 Real-time update: Homepage products loaded:",e.length);let t=e.map(e=>{var r,t,s;return{...e,comments:e.commentsCount||e.comments||0,sellerName:(null==(r=e.seller)?void 0:r.name)||e.sellerName||"",sellerRef:e.sellerRef||{id:e.sellerId||"",name:(null==(t=e.seller)?void 0:t.name)||e.sellerName||"",photoURL:(null==(s=e.seller)?void 0:s.avatar)||e.sellerPhoto||""},likes:e.likes||[],views:e.views||0,likeCount:e.likeCount||0,viewCount:e.viewCount||0,shareCount:e.shareCount||0}}).filter(e=>{let r="string"==typeof e.title?e.title.toLowerCase():"",t="string"==typeof e.sellerName?e.sellerName.toLowerCase():"",s=["organic cotton t-shirt","premium wireless headphones","demo smart watch"].some(e=>r.includes(e)||e.includes(r)),o=["ecofashion","audiomaster","techgear pro"].some(e=>t.includes(e)||e.includes(t));return!s&&!o}).sort((e,r)=>{let t=e.updatedAt||e.createdAt||new Date(0);return new Date(r.updatedAt||r.createdAt||new Date(0)).getTime()-new Date(t).getTime()});console.log("\uD83D\uDCF1 Real-time feed updated:",t.length,"products"),r(t),d(!1)})),()=>{e&&e()}},[b,!1]),(0,o.useEffect)(()=>{let e=setTimeout(()=>{t&&!b&&(console.log("Loading timeout reached, setting loading to false"),d(!1))},1e4);return()=>clearTimeout(e)},[t,b]),t)?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsx)("div",{className:"max-w-sm mx-auto md:max-w-none md:container md:mx-auto md:px-4 pt-4",children:(0,s.jsx)("div",{className:"space-y-6 md:grid md:grid-cols-4 md:gap-6 md:space-y-0",children:[...Array(8)].map((e,r)=>(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden animate-pulse",children:[(0,s.jsx)("div",{className:"aspect-square bg-gray-200"}),(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),(0,s.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,s.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})]}),(0,s.jsx)("div",{className:"h-10 bg-gray-200 rounded"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full"})]})]},r))})})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(w,{}),j.length>0&&(0,s.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"\uD83D\uDD25 Trending Now"}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Updated in real-time"})]}),(0,s.jsx)("div",{className:"flex space-x-4 overflow-x-auto pb-2",children:j.slice(0,5).map(e=>{var r;return(0,s.jsx)(n.P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"flex-shrink-0 w-32",children:(0,s.jsx)(u(),{href:"/product/".concat(e.id),children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:(null==(r=e.images)?void 0:r[0])||"/placeholder-product.jpg",alt:e.title,width:"128",height:"128",className:"w-32 h-32 object-cover rounded-lg"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-20 rounded-lg flex items-end",children:(0,s.jsxs)("div",{className:"p-2 text-white",children:[(0,s.jsx)("p",{className:"text-xs font-medium truncate",children:e.title}),(0,s.jsxs)("p",{className:"text-xs",children:["$",e.price]})]})})]})})},e.id)})})]})}),(0,s.jsx)("div",{className:"md:hidden",children:(0,s.jsx)("div",{className:"max-w-xs mx-auto space-y-4 pt-4",children:e.map((e,r)=>{var t,o,i,l,a,d;return(0,s.jsxs)(n.P.div,{initial:p?{opacity:0,y:50}:void 0,animate:p?{opacity:1,y:0}:void 0,transition:p?{delay:.1*r}:void 0,whileHover:p?{scale:1.02}:void 0,className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden mx-2",children:[(0,s.jsx)(u(),{href:"/product/".concat(e.id),className:"block relative",children:(0,s.jsxs)("div",{className:"bg-gray-900 dark:bg-gray-700 rounded-xl m-3 mb-0 aspect-square overflow-hidden",children:[(0,s.jsx)("img",{src:e.images[0]||"/placeholder-product.jpg",alt:e.title,className:"object-cover w-full h-full",onError:e=>{e.target.src="/placeholder-product.jpg"}}),(0,s.jsxs)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-white rounded-full opacity-60"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})]})]})}),(0,s.jsxs)("div",{className:"px-4 pt-3",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:e.title}),(0,s.jsxs)("p",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:["$",e.price]})]}),(0,s.jsxs)("div",{className:"px-4 pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center mb-3",children:[(0,s.jsx)(u(),{href:"/profile/".concat((null==(t=e.sellerRef)?void 0:t.id)||"user"),prefetch:!1,className:"hover:opacity-80",children:(0,s.jsx)("img",{src:(null==(o=e.sellerRef)?void 0:o.photoURL)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(encodeURIComponent((null==(i=e.sellerRef)?void 0:i.name)||e.sellerName||"user")),alt:(null==(l=e.sellerRef)?void 0:l.name)||e.sellerName,width:"40",height:"40",className:"rounded-full mr-3 cursor-pointer hover:opacity-80"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(u(),{href:"/profile/".concat((null==(a=e.sellerRef)?void 0:a.id)||"user"),className:"hover:opacity-80",children:(0,s.jsx)("h3",{className:"font-semibold text-base text-gray-900 dark:text-white",children:(null==(d=e.sellerRef)?void 0:d.name)||e.sellerName})}),(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"1.5K followers"})]})]}),(0,s.jsx)(u(),{href:"/product/".concat(e.id),className:"block",children:(0,s.jsx)(n.P.button,{whileHover:p?{scale:1.02}:void 0,whileTap:p?{scale:.98}:void 0,className:"w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl hover:bg-blue-700 transition-colors text-base",children:"Buy Now"})})]})]},e.id)})})}),(0,s.jsx)("div",{className:"hidden md:block",children:(0,s.jsx)("div",{className:"container mx-auto px-4 pt-8",children:(0,s.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4",children:e.map((e,r)=>{var t,o,i,l,a,d;return(0,s.jsxs)(n.P.div,{initial:p?{opacity:0,y:20}:void 0,animate:p?{opacity:1,y:0}:void 0,transition:p?{delay:.05*r}:void 0,whileHover:p?{scale:1.02}:void 0,className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden",children:[(0,s.jsx)(u(),{href:"/product/".concat(e.id),className:"block relative",children:(0,s.jsxs)("div",{className:"bg-gray-900 dark:bg-gray-700 rounded-xl m-3 mb-0 aspect-square overflow-hidden",children:[(0,s.jsx)("img",{src:e.images[0]||"/placeholder-product.jpg",alt:e.title,className:"object-cover w-full h-full",onError:e=>{e.target.src="/placeholder-product.jpg"}}),(0,s.jsxs)("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-white rounded-full opacity-60"}),(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})]})]})}),(0,s.jsxs)("div",{className:"px-3 pt-2",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-1 truncate",children:e.title}),(0,s.jsxs)("p",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:["$",e.price]})]}),(0,s.jsxs)("div",{className:"px-3 pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsx)(u(),{href:"/profile/".concat((null==(t=e.sellerRef)?void 0:t.id)||"user"),prefetch:!1,className:"hover:opacity-80",children:(0,s.jsx)("img",{src:(null==(o=e.sellerRef)?void 0:o.photoURL)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(encodeURIComponent((null==(i=e.sellerRef)?void 0:i.name)||e.sellerName||"user")),alt:(null==(l=e.sellerRef)?void 0:l.name)||e.sellerName,width:"32",height:"32",className:"rounded-full mr-2 cursor-pointer hover:opacity-80"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)(u(),{href:"/profile/".concat((null==(a=e.sellerRef)?void 0:a.id)||"user"),className:"hover:opacity-80",children:(0,s.jsx)("h3",{className:"font-semibold text-sm text-gray-900 dark:text-white truncate",children:(null==(d=e.sellerRef)?void 0:d.name)||e.sellerName})}),(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"1.5K followers"})]})]}),(0,s.jsx)(u(),{href:"/product/".concat(e.id),className:"block",children:(0,s.jsx)(n.P.button,{whileHover:p?{scale:1.02}:void 0,whileTap:p?{scale:.98}:void 0,className:"w-full bg-blue-600 text-white font-semibold py-2 px-3 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Buy Now"})})]})]},e.id)})})})}),t&&0===e.length?(console.log("\uD83D\uDCED HOMEPAGE: Showing loading state"),(0,s.jsx)("div",{className:"flex justify-center items-center min-h-[60vh]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading amazing products..."})]})})):t||0!==e.length?null:(console.log("\uD83D\uDCED HOMEPAGE: Showing empty state - No products found"),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDECD️"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No products yet"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Be the first to share a product!"}),(0,s.jsx)(u(),{href:"/become-seller",className:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors",children:"Start Selling"})]}))]})}},8813:(e,r,t)=>{"use strict";t.d(r,{I_:()=>u,TV:()=>h,createProduct:()=>l,d$:()=>c,deleteProduct:()=>d,oo:()=>a,updateProduct:()=>n,vC:()=>m});var s=t(35317),o=t(25610),i=t(95997);let l=async e=>{try{if(!await (0,i.eT)(e.sellerId))throw Error("Only approved sellers can create products");let r={id:e.sellerId,name:e.sellerName||"",type:"personal"};try{let t=await (0,s.x7)((0,s.doc)(o.db,"users",e.sellerId));if(t.exists()){let s=t.data();r={id:s.id||e.sellerId,name:s.name||e.sellerName||"",type:s.sellerType||s.role||"personal"}}}catch(e){console.warn("Could not fetch seller info for product creation:",e)}return(await (0,s.addDoc)((0,s.collection)(o.db,"products"),Object.assign(Object.assign({},e),{seller:r,sellerRef:{id:r.id,name:r.name,photoURL:""},likes:[],views:0,rating:0,reviewCount:0,comments:0,status:"active",createdAt:(0,s.serverTimestamp)(),updatedAt:(0,s.serverTimestamp)()}))).id}catch(e){throw console.error("Error creating product:",e),e}},a=async e=>{try{let r=(0,s.doc)(o.db,"products",e),t=await (0,s.x7)(r);if(t.exists()){let e=Object.assign({id:t.id},t.data());if(e.sellerId)try{let r=await (0,s.x7)((0,s.doc)(o.db,"users",e.sellerId));if(r.exists()){let t=r.data();e.seller={id:t.id,name:t.name,avatar:t.avatar,isVerified:t.isVerified,rating:t.rating}}}catch(e){console.warn("Could not fetch seller information:",e)}return e}return null}catch(e){throw console.error("Error getting product:",e),e}},n=async(e,r)=>{try{let t=(0,s.doc)(o.db,"products",e);await (0,s.mZ)(t,Object.assign(Object.assign({},r),{updatedAt:(0,s.serverTimestamp)()}))}catch(e){throw console.error("Error updating product:",e),e}},d=async e=>{try{let r=(0,s.doc)(o.db,"products",e);await (0,s.kd)(r)}catch(e){throw console.error("Error deleting product:",e),e}},c=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"createdAt",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;try{let l=(0,s.collection)(o.db,"products"),a=[];e.category&&a.push({field:"category",operator:"==",value:e.category}),e.sellerId&&a.push({field:"sellerId",operator:"==",value:e.sellerId}),e.status?a.push({field:"status",operator:"==",value:e.status}):a.push({field:"status",operator:"==",value:"active"}),void 0!==e.minPrice&&a.push({field:"price",operator:">=",value:e.minPrice}),void 0!==e.maxPrice&&a.push({field:"price",operator:"<=",value:e.maxPrice}),a.forEach(e=>{l=(0,s.query)(l,(0,s.where)(e.field,e.operator,e.value))}),l=(0,s.query)(l,(0,s.My)(r,t)),l=(0,s.query)(l,(0,s.AB)(i));let n=(await (0,s.getDocs)(l)).docs.map(e=>Object.assign({id:e.id},e.data()));if(e.search){let r=e.search.toLowerCase();n=n.filter(e=>{var t;return e.title.toLowerCase().includes(r)||e.description.toLowerCase().includes(r)||(null==(t=e.brand)?void 0:t.toLowerCase().includes(r))})}let d=[...new Set(n.map(e=>e.sellerId))],c=new Map;for(let e of d)try{let r=await (0,s.x7)((0,s.doc)(o.db,"users",e));r.exists()&&c.set(e,r.data())}catch(r){console.warn("Could not fetch seller ".concat(e,":"),r)}return n.map(e=>{let r=c.get(e.sellerId);return r&&(e.seller={id:r.id,name:r.name,avatar:r.avatar,isVerified:r.isVerified,rating:r.rating}),e})}catch(e){return console.log("Firebase products not accessible, returning empty array"),[]}},u=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"createdAt",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"desc",l=(0,s.collection)(o.db,"products"),a=[];return r.category&&a.push({field:"category",operator:"==",value:r.category}),r.sellerId&&a.push({field:"sellerId",operator:"==",value:r.sellerId}),r.status&&a.push({field:"status",operator:"==",value:r.status}),void 0!==r.minPrice&&a.push({field:"price",operator:">=",value:r.minPrice}),void 0!==r.maxPrice&&a.push({field:"price",operator:"<=",value:r.maxPrice}),a.forEach(e=>{l=(0,s.query)(l,(0,s.where)(e.field,e.operator,e.value))}),l=(0,s.query)(l,(0,s.My)(t,i)),(0,s.onSnapshot)(l,async t=>{console.log("Products found:",t.docs.length);let i=t.docs.map(e=>Object.assign({id:e.id},e.data()));if(r.search){let e=r.search.toLowerCase();i=i.filter(r=>{var t;return r.title.toLowerCase().includes(e)||r.description.toLowerCase().includes(e)||(null==(t=r.brand)?void 0:t.toLowerCase().includes(e))})}let l=[...new Set(i.map(e=>e.sellerId))],a=new Map;for(let e of l)try{let r=await (0,s.x7)((0,s.doc)(o.db,"users",e));r.exists()&&a.set(e,r.data())}catch(r){console.warn("Could not fetch seller ".concat(e,":"),r)}e(i.map(e=>{let r=a.get(e.sellerId);return r&&(e.seller={id:r.id,name:r.name,avatar:r.avatar,isVerified:r.isVerified,rating:r.rating}),e}))},r=>{console.error("Firestore error:",r.message),e([])})},m=async(e,r)=>{try{let t=await a(e);if(!t)throw Error("Product not found");let s=t.likes||[];s.includes(r)?await n(e,{likes:s.filter(e=>e!==r)}):await n(e,{likes:[...s,r]})}catch(e){throw console.error("Error toggling product like:",e),e}},h=async e=>c({sellerId:e})},33681:(e,r,t)=>{"use strict";t.d(r,{q:()=>h});var s=t(88693),o=t(35317),i=t(25610);let l=()=>new Promise(e=>{let r=i.j2.onAuthStateChanged(t=>{r(),e(t)});setTimeout(()=>{r(),e(null)},5e3)}),a=()=>{var e;return(null==(e=i.j2.currentUser)?void 0:e.uid)||null},n=async(e,r)=>{try{if(!e)throw Error("User ID is required");if(!i.j2.currentUser||a()!==e){let r=await l();if(!r||r.uid!==e)throw Error("Permission denied. Please make sure you are logged in.")}console.log("Adding product to wishlist for user:",e);let t=(0,o.doc)(i.db,"wishlists",e),s=await (0,o.x7)(t),n={items:[],updatedAt:(0,o.serverTimestamp)()};s.exists()&&(n=s.data());let d=n.items.findIndex(e=>e.productId===r.id);if(-1!==d)throw Error("Product already in wishlist");let c={id:r.id,userId:e,productId:r.id,product:r,addedAt:new Date};n.items.push(c),await (0,o.mZ)(t,{items:n.items,updatedAt:(0,o.serverTimestamp)()}),console.log("Successfully added product to wishlist for user:",e)}catch(e){if(console.error("Error adding to wishlist:",e),e.code){if("permission-denied"===e.code)throw Error("Permission denied. Please make sure you are logged in.");throw e}throw Error(e.message||"Failed to add item to wishlist")}},d=async(e,r)=>{try{if(!e)throw Error("User ID is required");if(!i.j2.currentUser||a()!==e){let r=await l();if(!r||r.uid!==e)throw Error("Permission denied. Please make sure you are logged in.")}console.log("Removing product from wishlist for user:",e,"product:",r);let t=(0,o.doc)(i.db,"wishlists",e),s=await (0,o.x7)(t);if(!s.exists())return void console.log("Wishlist document does not exist for user:",e);let n=s.data().items.filter(e=>e.productId!==r);await (0,o.mZ)(t,{items:n,updatedAt:(0,o.serverTimestamp)()}),console.log("Successfully removed product from wishlist for user:",e)}catch(e){if(console.error("Error removing from wishlist:",e),e.code){if("permission-denied"===e.code)throw Error("Permission denied. Please make sure you are logged in.");throw e}throw Error(e.message||"Failed to remove item from wishlist")}},c=async e=>{try{if(!e)throw Error("User ID is required");if(!i.j2.currentUser||a()!==e){let r=await l();if(!r||r.uid!==e)throw Error("Permission denied. Please make sure you are logged in.")}console.log("Attempting to fetch wishlist for user:",e);let r=(0,o.doc)(i.db,"wishlists",e),t=await (0,o.x7)(r);if(!t.exists())return console.log("Wishlist document does not exist for user:",e),[];let s=t.data();return console.log("Successfully fetched wishlist for user:",e),s.items||[]}catch(e){if(console.error("Error getting user wishlist:",e),e.code){if("permission-denied"===e.code)throw Error("Permission denied. Please make sure you are logged in.");throw e}throw Error(e.message||"Failed to load wishlist")}};var u=t(68084);let m=new Set,h=(0,s.vt)((e,r)=>({wishlist:[],loading:!1,error:null,setWishlist:r=>e({wishlist:r}),setLoading:r=>e({loading:r}),setError:r=>e({error:r}),initializeWishlist:async r=>{if(!r)return void e({error:"User not authenticated",loading:!1});if(!m.has(r)){m.add(r),console.log("Initializing wishlist for:",r),e({loading:!0,error:null});try{let t=await c(r);e({wishlist:t,loading:!1}),console.log("Wishlist initialized successfully for:",r);let s=((e,r)=>{if(!e)return console.error("User ID is required for wishlist subscription"),r([]),()=>{};if(!i.j2.currentUser||a()!==e)return console.error("Permission denied. User not authenticated for wishlist subscription"),r([]),()=>{};console.log("Subscribing to wishlist for user:",e);let t=(0,o.doc)(i.db,"wishlists",e);return(0,o.onSnapshot)(t,t=>{t.exists()?r(t.data().items||[]):(console.log("Wishlist document does not exist for user:",e),r([]))},e=>{console.error("Error subscribing to wishlist:",e),e.code&&console.error("Firebase error code:",e.code),r([])})})(r,r=>{e({wishlist:r})});window.wishlistUnsubscribe=s}catch(t){console.error("Error initializing wishlist:",t),m.delete(r),(null==t?void 0:t.code)==="permission-denied"||(null==t?void 0:t.message)&&t.message.includes("Permission denied")?e({error:"Permission denied. Please make sure you are logged in.",loading:!1,wishlist:[]}):e({error:t.message||"Failed to load wishlist",loading:!1})}}},addToWishlist:async r=>{let{user:t}=u.useAuthStore.getState();if(t){if(!t.uid)return void e({error:"User ID not available"});e({loading:!0,error:null});try{await n(t.uid,r),e({loading:!1,error:null})}catch(r){console.error("Error adding to wishlist:",r),(null==r?void 0:r.code)==="permission-denied"||(null==r?void 0:r.message)&&r.message.includes("Permission denied")?e({error:"Permission denied. Please make sure you are logged in.",loading:!1}):e({error:r.message||"Failed to add item to wishlist",loading:!1})}}},removeFromWishlist:async r=>{let{user:t}=u.useAuthStore.getState();if(!t)return void e({error:"Please login to remove items from wishlist"});if(!t.uid)return void e({error:"User ID not available"});e({loading:!0,error:null});try{await d(t.uid,r),e({loading:!1,error:null})}catch(r){console.error("Error removing from wishlist:",r),(null==r?void 0:r.code)==="permission-denied"||(null==r?void 0:r.message)&&r.message.includes("Permission denied")?e({error:"Permission denied. Please make sure you are logged in.",loading:!1}):e({error:r.message||"Failed to remove item from wishlist",loading:!1})}},isInWishlist:e=>{let{wishlist:t}=r();return t.some(r=>r.productId===e)},getWishlistCount:()=>{let{wishlist:e}=r();return e.length}}))},47439:(e,r,t)=>{"use strict";t.d(r,{QM:()=>i,V6:()=>l,nJ:()=>a});var s=t(25610),o=t(90858);let i=async(e,r,t)=>{console.log("=== FIREBASE UPLOAD DEBUG START ==="),console.log("Starting file upload..."),console.log("File:",e.name,"Size:",e.size,"Type:",e.type),console.log("Upload path:",r),console.log("Firebase storage initialized:",!!s.storage),console.log("=========================");try{if(!s.storage)throw Error("Firebase storage not initialized");let i=(0,o.ref)(s.storage,r),l=(0,o.bp)(i,e);return new Promise((s,i)=>{l.on("state_changed",e=>{let r=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+r+"% done"),t&&t(r)},e=>{console.error("Firebase upload error:",e),i(e)},async()=>{try{let t=await (0,o.getDownloadURL)(l.snapshot.ref);console.log("File available at",t),s({url:t,path:r,name:e.name})}catch(e){console.error("Error getting download URL:",e),i(e)}})})}catch(t){return console.error("Error uploading file:",t),console.error("Full error details:",JSON.stringify(t,null,2)),{url:"https://via.placeholder.com/400x400/6366f1/ffffff?text=".concat(encodeURIComponent(e.name)),path:r,name:e.name}}},l=async function(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"products",s=arguments.length>3?arguments[3]:void 0,o=Date.now(),l="".concat(o,"_").concat(e.name);return i(e,"".concat(t,"/").concat(r,"/").concat(l),s)},a=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0xa00000,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["image/jpeg","image/png","image/webp","video/mp4","video/mov"];return e.size>r?{valid:!1,error:"File size must be less than ".concat(Math.round(r/1024/1024),"MB")}:t.includes(e.type)?{valid:!0}:{valid:!1,error:"File type not allowed. Allowed types: ".concat(t.join(", "))}}},50960:(e,r,t)=>{Promise.resolve().then(t.bind(t,1740))},81875:(e,r,t)=>{"use strict";t.d(r,{F_:()=>n,RZ:()=>d,dU:()=>a,ko:()=>l,pt:()=>c});var s=t(35317),o=t(25610),i=t(47439);let l=async function(e,r,t,l){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"public";try{let n=l.type.startsWith("video/"),d=await (0,i.V6)(l,e,"stories"),c=new Date,u=new Date(c.getTime()+864e5),m={userId:e,userName:r,userPhoto:t,storyImage:n?"":d.url,storyImagePath:n?"":d.path,storyVideo:n?d.url:"",storyVideoPath:n?d.path:"",mediaType:n?"video":"image",privacy:a,createdAt:(0,s.serverTimestamp)(),expiresAt:s.Dc.fromDate(u),views:[],isActive:!0},h=await (0,s.addDoc)((0,s.collection)(o.db,"stories"),m);return console.log("Story created successfully:",h.id),h.id}catch(e){throw console.error("Error creating story:",e),e}},a=async()=>{try{let e=(0,s.query)((0,s.collection)(o.db,"stories"),(0,s.where)("isActive","==",!0),(0,s.My)("createdAt","desc"),(0,s.AB)(10)),r=await (0,s.getDocs)(e),t=new Date,i=r.docs.map(e=>Object.assign({id:e.id},e.data())).filter(e=>{let r=e.expiresAt.toDate(),s="public"===e.privacy;return r>t&&s});return console.log("Loaded stories:",i.length),i}catch(e){return console.error("Error getting all stories:",e),console.log("Firestore error details:",e),[]}},n=async(e,r)=>{try{let t=(0,s.doc)(o.db,"stories",e);await (0,s.mZ)(t,{views:(0,s.hq)(r)})}catch(e){throw console.error("Error marking story as viewed:",e),e}},d=async(e,r)=>{try{let t=(0,s.doc)(o.db,"stories",e),i=await (0,s.getDocs)((0,s.query)((0,s.collection)(o.db,"stories"),(0,s.where)("__name__","==",e)));if(!i.empty)if(i.docs[0].data().userId===r)await (0,s.kd)(t);else throw Error("Unauthorized to delete this story")}catch(e){throw console.error("Error deleting story:",e),e}},c=(e,r)=>{let t;return r&&r.length>0?(t=(0,s.query)((0,s.collection)(o.db,"stories"),(0,s.where)("userId","in",r.slice(0,10)),(0,s.where)("isActive","==",!0),(0,s.My)("createdAt","desc"),(0,s.AB)(10)),(0,s.onSnapshot)(t,r=>{e(r.docs.map(e=>Object.assign({id:e.id},e.data())))})):(t=(0,s.query)((0,s.collection)(o.db,"stories"),(0,s.where)("isActive","==",!0),(0,s.My)("createdAt","desc"),(0,s.AB)(10)),(0,s.onSnapshot)(t,r=>{let t=new Date;e(r.docs.map(e=>Object.assign({id:e.id},e.data())).filter(e=>{let r=e.expiresAt.toDate(),s="public"===e.privacy;return r>t&&s}))}))}},98868:(e,r,t)=>{"use strict";t.d(r,{n:()=>n});var s=t(88693),o=t(35317),i=t(25610);let l=new Map,a=new Map,n=(0,s.vt)((e,r)=>({profile:null,loading:!1,error:null,fetchProfile:async r=>{var t,s;if(l.get(r))return void console.log("\uD83D\uDEAB BLOCKED: Already fetching profile for:",r);e({loading:!0,error:null});let n=a.get(r);if(n){console.log("\uD83D\uDCBE CACHE HIT: Using cached profile for:",r),e({profile:n,loading:!1,error:null});return}console.log("\uD83D\uDD0D Store: Starting fetchProfile for:",r);try{let n=await (0,o.x7)((0,o.doc)(i.db,"users",r));if(n.exists()){let o=n.data(),i=Object.assign(Object.assign({id:r,joinedAt:(null==(t=o.joinedAt)?void 0:t.toDate())||new Date,usernameLastChanged:null==(s=o.usernameLastChanged)?void 0:s.toDate()},o),{customPhotoURL:o.customPhotoURL||"",photoURL:o.photoURL||"",profilePic:o.profilePic||"",avatar:o.avatar||"",name:o.name&&"string"==typeof o.name&&o.name.trim()||"User",bio:o.bio&&"string"==typeof o.bio?o.bio.trim():"",followers:Array.isArray(o.followers)?o.followers:[],following:Array.isArray(o.following)?o.following:[]});console.log("✅ Store: Profile loaded successfully:",i.name,i.id),a.set(r,i),e({profile:i,loading:!1})}else console.log("❌ Store: Profile document does not exist for:",r),l.delete(r),e({profile:null,loading:!1,error:"Profile not found. This user may not exist or their profile may be private."})}catch(t){console.error("❌ Store: Firestore error:",t),l.delete(r),e({profile:null,loading:!1,error:"Failed to load profile. Please check your internet connection and try again."})}},subscribeToProfile:e=>(console.log("\uD83D\uDD14 Subscription disabled to prevent infinite loops for:",e),()=>{}),updateProfile:async(t,s)=>{try{await (0,o.mZ)((0,o.doc)(i.db,"users",t),s);let l=r().profile;l&&l.id===t&&e({profile:Object.assign(Object.assign({},l),s)})}catch(e){throw console.error("Error updating profile:",e),e}},createProfile:async(r,t)=>{try{let s=Object.assign(Object.assign({},t),{id:r,joinedAt:new Date});await (0,o.BN)((0,o.doc)(i.db,"users",r),s),e({profile:s,loading:!1,error:null})}catch(r){console.error("Error creating profile:",r),e({error:"Failed to create profile",loading:!1})}},followUser:async(t,s)=>{try{let l=(0,o.doc)(i.db,"users",t),a=(0,o.doc)(i.db,"users",s);await (0,o.mZ)(l,{following:(0,o.hq)(s)}),await (0,o.mZ)(a,{followers:(0,o.hq)(t)});let n=r().profile;if(n&&n.id===t){let r=Array.isArray(n.following)?n.following:[];e({profile:Object.assign(Object.assign({},n),{following:[...r.filter(e=>e!==s),s]})})}}catch(e){throw console.error("Error following user:",e),e}},unfollowUser:async(t,s)=>{try{let l=(0,o.doc)(i.db,"users",t),a=(0,o.doc)(i.db,"users",s);await (0,o.mZ)(l,{following:(0,o.C3)(s)}),await (0,o.mZ)(a,{followers:(0,o.C3)(t)});let n=r().profile;if(n&&n.id===t){let r=Array.isArray(n.following)?n.following:[];e({profile:Object.assign(Object.assign({},n),{following:r.filter(e=>e!==s)})})}}catch(e){throw console.error("Error unfollowing user:",e),e}},fetchUserAnalytics:async e=>{try{return{monthlySales:0,monthlyOrders:0,monthlyRefunds:0,topProducts:[]}}catch(e){throw console.error("Error fetching analytics:",e),e}},clearProfile:()=>{e({profile:null,loading:!1,error:null})},clearUserCache:e=>{a.delete(e),l.delete(e),console.log("\uD83D\uDDD1️ Cleared cache and tracker for:",e)}}))}},e=>{e.O(0,[2992,9507,1794,6899,6671,8599,7194,6874,4551,6935,8441,5964,7358],()=>e(e.s=50960)),_N_E=e.O()}]);