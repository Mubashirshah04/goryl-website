(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2959],{8813:(e,r,t)=>{"use strict";t.d(r,{I_:()=>u,TV:()=>g,createProduct:()=>i,d$:()=>d,deleteProduct:()=>n,oo:()=>o,updateProduct:()=>c,vC:()=>m});var s=t(35317),a=t(25610),l=t(95997);let i=async e=>{try{if(!await (0,l.eT)(e.sellerId))throw Error("Only approved sellers can create products");let r={id:e.sellerId,name:e.sellerName||"",type:"personal"};try{let t=await (0,s.x7)((0,s.doc)(a.db,"users",e.sellerId));if(t.exists()){let s=t.data();r={id:s.id||e.sellerId,name:s.name||e.sellerName||"",type:s.sellerType||s.role||"personal"}}}catch(e){console.warn("Could not fetch seller info for product creation:",e)}return(await (0,s.addDoc)((0,s.collection)(a.db,"products"),Object.assign(Object.assign({},e),{seller:r,sellerRef:{id:r.id,name:r.name,photoURL:""},likes:[],views:0,rating:0,reviewCount:0,comments:0,status:"active",createdAt:(0,s.serverTimestamp)(),updatedAt:(0,s.serverTimestamp)()}))).id}catch(e){throw console.error("Error creating product:",e),e}},o=async e=>{try{let r=(0,s.doc)(a.db,"products",e),t=await (0,s.x7)(r);if(t.exists()){let e=Object.assign({id:t.id},t.data());if(e.sellerId)try{let r=await (0,s.x7)((0,s.doc)(a.db,"users",e.sellerId));if(r.exists()){let t=r.data();e.seller={id:t.id,name:t.name,avatar:t.avatar,isVerified:t.isVerified,rating:t.rating}}}catch(e){console.warn("Could not fetch seller information:",e)}return e}return null}catch(e){throw console.error("Error getting product:",e),e}},c=async(e,r)=>{try{let t=(0,s.doc)(a.db,"products",e);await (0,s.mZ)(t,Object.assign(Object.assign({},r),{updatedAt:(0,s.serverTimestamp)()}))}catch(e){throw console.error("Error updating product:",e),e}},n=async e=>{try{let r=(0,s.doc)(a.db,"products",e);await (0,s.kd)(r)}catch(e){throw console.error("Error deleting product:",e),e}},d=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"createdAt",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;try{let i=(0,s.collection)(a.db,"products"),o=[];e.category&&o.push({field:"category",operator:"==",value:e.category}),e.sellerId&&o.push({field:"sellerId",operator:"==",value:e.sellerId}),e.status?o.push({field:"status",operator:"==",value:e.status}):o.push({field:"status",operator:"==",value:"active"}),void 0!==e.minPrice&&o.push({field:"price",operator:">=",value:e.minPrice}),void 0!==e.maxPrice&&o.push({field:"price",operator:"<=",value:e.maxPrice}),o.forEach(e=>{i=(0,s.query)(i,(0,s.where)(e.field,e.operator,e.value))}),i=(0,s.query)(i,(0,s.My)(r,t)),i=(0,s.query)(i,(0,s.AB)(l));let c=(await (0,s.getDocs)(i)).docs.map(e=>Object.assign({id:e.id},e.data()));if(e.search){let r=e.search.toLowerCase();c=c.filter(e=>{var t;return e.title.toLowerCase().includes(r)||e.description.toLowerCase().includes(r)||(null==(t=e.brand)?void 0:t.toLowerCase().includes(r))})}let n=[...new Set(c.map(e=>e.sellerId))],d=new Map;for(let e of n)try{let r=await (0,s.x7)((0,s.doc)(a.db,"users",e));r.exists()&&d.set(e,r.data())}catch(r){console.warn("Could not fetch seller ".concat(e,":"),r)}return c.map(e=>{let r=d.get(e.sellerId);return r&&(e.seller={id:r.id,name:r.name,avatar:r.avatar,isVerified:r.isVerified,rating:r.rating}),e})}catch(e){return console.log("Firebase products not accessible, returning empty array"),[]}},u=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"createdAt",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"desc",i=(0,s.collection)(a.db,"products"),o=[];return r.category&&o.push({field:"category",operator:"==",value:r.category}),r.sellerId&&o.push({field:"sellerId",operator:"==",value:r.sellerId}),r.status&&o.push({field:"status",operator:"==",value:r.status}),void 0!==r.minPrice&&o.push({field:"price",operator:">=",value:r.minPrice}),void 0!==r.maxPrice&&o.push({field:"price",operator:"<=",value:r.maxPrice}),o.forEach(e=>{i=(0,s.query)(i,(0,s.where)(e.field,e.operator,e.value))}),i=(0,s.query)(i,(0,s.My)(t,l)),(0,s.onSnapshot)(i,async t=>{console.log("Products found:",t.docs.length);let l=t.docs.map(e=>Object.assign({id:e.id},e.data()));if(r.search){let e=r.search.toLowerCase();l=l.filter(r=>{var t;return r.title.toLowerCase().includes(e)||r.description.toLowerCase().includes(e)||(null==(t=r.brand)?void 0:t.toLowerCase().includes(e))})}let i=[...new Set(l.map(e=>e.sellerId))],o=new Map;for(let e of i)try{let r=await (0,s.x7)((0,s.doc)(a.db,"users",e));r.exists()&&o.set(e,r.data())}catch(r){console.warn("Could not fetch seller ".concat(e,":"),r)}e(l.map(e=>{let r=o.get(e.sellerId);return r&&(e.seller={id:r.id,name:r.name,avatar:r.avatar,isVerified:r.isVerified,rating:r.rating}),e}))},r=>{console.error("Firestore error:",r.message),e([])})},m=async(e,r)=>{try{let t=await o(e);if(!t)throw Error("Product not found");let s=t.likes||[];s.includes(r)?await c(e,{likes:s.filter(e=>e!==r)}):await c(e,{likes:[...s,r]})}catch(e){throw console.error("Error toggling product like:",e),e}},g=async e=>d({sellerId:e})},8933:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>N});var s=t(95155),a=t(12115),l=t(35695),i=t(29700),o=t(8813),c=t(60760),n=t(1978),d=t(47924),u=t(66932),m=t(38564),g=t(27809),p=t(51976),h=t(62108),x=t(56671),f=t(6874),v=t.n(f),y=t(68084),b=t(66935);let j=["All Categories","Fashion & Clothing","Electronics","Home & Garden","Beauty & Health","Sports & Outdoors","Books & Media","Toys & Games","Automotive","Food & Beverages"];function w(){let e=(0,l.useSearchParams)().get("q")||"",{user:r}=(0,y.useAuthStore)(),{addItem:t}=(0,b.x)(),[f,w]=(0,a.useState)([]),[N,C]=(0,a.useState)(!1),[k,P]=(0,a.useState)(e),[S,A]=(0,a.useState)(!1),[L,I]=(0,a.useState)({category:"All Categories",minPrice:0,maxPrice:1e3,rating:0,inStock:!1}),[E,O]=(0,a.useState)("relevance"),[F,R]=(0,a.useState)(!1);(0,a.useEffect)(()=>{R(!0)},[]),(0,a.useEffect)(()=>{e&&(P(e),T(e))},[e]);let T=async e=>{if(e.trim()){C(!0);try{let r=[];try{r=await (0,i.zh)(e,L)}catch(t){console.log("Firebase search failed, using fallback:",t),r=(await (0,o.d$)()).filter(r=>r.title.toLowerCase().includes(e.toLowerCase())||r.description.toLowerCase().includes(e.toLowerCase())||r.category.toLowerCase().includes(e.toLowerCase())||r.sellerName.toLowerCase().includes(e.toLowerCase())).map(e=>({...e,id:e.id||"",likes:e.likes||[],rating:e.rating||0,reviewCount:e.reviewCount||0,stock:e.stock||0}))}let t=r;switch("All Categories"!==L.category&&(t=t.filter(e=>e.category===L.category)),L.minPrice>0&&(t=t.filter(e=>e.price>=L.minPrice)),L.maxPrice<1e3&&(t=t.filter(e=>e.price<=L.maxPrice)),L.rating>0&&(t=t.filter(e=>e.rating>=L.rating)),L.inStock&&(t=t.filter(e=>e.stock>0)),E){case"price-low":t.sort((e,r)=>e.price-r.price);break;case"price-high":t.sort((e,r)=>r.price-e.price);break;case"rating":t.sort((e,r)=>r.rating-e.rating);break;case"newest":t.sort((e,r)=>new Date(r.createdAt||0).getTime()-new Date(e.createdAt||0).getTime())}w(t)}catch(e){console.error("Search error:",e),x.oR.error("Failed to perform search")}finally{C(!1)}}},q=(e,r)=>{I({...L,[e]:r}),k.trim()&&T(k.trim())},M=()=>{I({category:"All Categories",minPrice:0,maxPrice:1e3,rating:0,inStock:!1}),k.trim()&&T(k.trim())};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Search Results"}),(0,s.jsx)("form",{onSubmit:e=>{e.preventDefault(),k.trim()&&T(k.trim())},className:"mb-6",children:(0,s.jsxs)("div",{className:"relative max-w-2xl",children:[(0,s.jsx)(d.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,s.jsx)("input",{type:"text",value:k,onChange:e=>P(e.target.value),placeholder:"Search products, sellers, categories...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900"}),(0,s.jsx)("button",{type:"submit",className:"absolute right-3 top-1/2 transform -translate-y-1/2 bg-purple-600 text-white px-4 py-1 rounded-md hover:bg-purple-700 transition-colors",children:"Search"})]})}),!N&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("p",{className:"text-gray-600",children:[f.length," ",1===f.length?"result":"results",' for "',k,'"']}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("select",{value:E,onChange:e=>{O(e.target.value),k.trim()&&T(k.trim())},className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900",children:[(0,s.jsx)("option",{value:"relevance",children:"Sort by Relevance"}),(0,s.jsx)("option",{value:"price-low",children:"Price: Low to High"}),(0,s.jsx)("option",{value:"price-high",children:"Price: High to Low"}),(0,s.jsx)("option",{value:"rating",children:"Highest Rated"}),(0,s.jsx)("option",{value:"newest",children:"Newest First"})]}),(0,s.jsxs)("button",{onClick:()=>A(!S),className:"flex items-center space-x-2 bg-white border border-gray-300 rounded-lg px-4 py-2 hover:bg-gray-50 transition-colors",children:[(0,s.jsx)(u.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Filters"})]})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsx)(c.N,{children:S&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"bg-white rounded-lg shadow-sm p-6 mb-6 lg:mb-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Filters"}),(0,s.jsx)("button",{onClick:M,className:"text-purple-600 hover:text-purple-700 text-sm",children:"Clear All"})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Category"}),(0,s.jsx)("select",{value:L.category,onChange:e=>q("category",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900",children:j.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Price Range"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Min Price"}),(0,s.jsx)("input",{type:"number",value:L.minPrice,onChange:e=>q("minPrice",Number(e.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900",placeholder:"0"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Max Price"}),(0,s.jsx)("input",{type:"number",value:L.maxPrice,onChange:e=>q("maxPrice",Number(e.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900",placeholder:"1000"})]})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Minimum Rating"}),(0,s.jsxs)("select",{value:L.rating,onChange:e=>q("rating",Number(e.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900",children:[(0,s.jsx)("option",{value:0,children:"Any Rating"}),(0,s.jsx)("option",{value:4,children:"4+ Stars"}),(0,s.jsx)("option",{value:3,children:"3+ Stars"}),(0,s.jsx)("option",{value:2,children:"2+ Stars"})]})]}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:L.inStock,onChange:e=>q("inStock",e.target.checked),className:"text-purple-600 focus:ring-purple-500 border-gray-300 rounded"}),(0,s.jsx)("span",{className:"text-gray-900",children:"In Stock Only"})]})})]})})}),(0,s.jsx)("div",{className:"lg:col-span-3",children:N?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(9)].map((e,r)=>(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden animate-pulse",children:[(0,s.jsx)("div",{className:"aspect-square bg-gray-200"}),(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),(0,s.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3"})]})]},r))}):0===f.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(d.A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No products found"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Try adjusting your search terms or filters to find what you're looking for."}),(0,s.jsx)("button",{onClick:M,className:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors",children:"Clear Filters"})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:(0,s.jsx)(c.N,{children:f.map((e,a)=>(0,s.jsxs)(n.P.div,{initial:F?{opacity:0,y:20}:void 0,animate:F?{opacity:1,y:0}:void 0,transition:F?{delay:.1*a}:void 0,whileHover:F?{scale:1.02}:void 0,className:"bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-lg transition-all duration-300",children:[(0,s.jsx)(v(),{href:"/product/".concat(e.id),children:(0,s.jsx)("div",{className:"relative aspect-square",children:(0,s.jsx)("img",{src:e.images[0]||"/placeholder-product.jpg",alt:e.title,className:"object-cover cursor-pointer w-full h-full"})})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("div",{className:"flex items-center mb-2",children:(0,s.jsx)("span",{className:"text-sm text-gray-600",children:e.sellerName})}),(0,s.jsx)(v(),{href:"/product/".concat(e.id),children:(0,s.jsx)("h3",{className:"font-semibold text-gray-900 text-sm line-clamp-2 hover:text-purple-600 transition-colors cursor-pointer mb-2",children:e.title})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("p",{className:"text-lg font-bold text-gray-900",children:["$",e.price]}),e.stock>0?(0,s.jsx)("span",{className:"text-green-600 text-sm",children:"In Stock"}):(0,s.jsx)("span",{className:"text-red-600 text-sm",children:"Out of Stock"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,s.jsx)("div",{className:"flex items-center",children:[void 0,void 0,void 0,void 0,void 0].map((r,t)=>(0,s.jsx)(m.A,{className:"w-4 h-4 ".concat(t<e.rating?"text-yellow-400 fill-current":"text-gray-300")},t))}),(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:[e.rating.toFixed(1)," (",e.reviewCount,")"]})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("button",{onClick:()=>(e=>{if(!r)return void x.oR.error("Please login to add items to cart");t({id:e.id,title:e.title,price:e.price,image:e.images[0]||"/placeholder-product.jpg",quantity:1}),x.oR.success("Added to cart!")})(e),disabled:0===e.stock,className:"flex-1 bg-purple-600 text-white py-2 px-3 rounded-lg text-sm font-medium hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center space-x-1",children:[(0,s.jsx)(g.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Add to Cart"})]}),(0,s.jsx)("button",{className:"bg-gray-100 text-gray-600 p-2 rounded-lg hover:bg-gray-200 transition-colors",children:(0,s.jsx)(p.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{className:"bg-gray-100 text-gray-600 p-2 rounded-lg hover:bg-gray-200 transition-colors",children:(0,s.jsx)(h.A,{className:"w-4 h-4"})})]})]})]},e.id))})})})]})]})})}function N(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}),children:(0,s.jsx)(w,{})})}},41902:(e,r,t)=>{Promise.resolve().then(t.bind(t,8933))}},e=>{e.O(0,[2992,9507,1794,6899,6671,8599,7194,6874,9325,6935,9700,8441,5964,7358],()=>e(e.s=41902)),_N_E=e.O()}]);