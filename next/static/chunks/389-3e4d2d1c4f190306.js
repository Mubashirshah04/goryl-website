"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[389,5610],{25610:(e,t,r)=>{r.d(t,{db:()=>p,j2:()=>u,storage:()=>g});var a=r(23915),s=r(16203),n=r(35317),o=r(90858),i=r(92144),c=r(81115),l=r(86864);let d=(0,a.Wp)({apiKey:"AIzaSyByhCgo_k9i8_AstSaZkZ3Atv5Rt2eOjhc",authDomain:"zaillisy.firebaseapp.com",databaseURL:"https://zaillisy-default-rtdb.firebaseio.com",projectId:"zaillisy",storageBucket:"zaillisy.firebasestorage.app",messagingSenderId:"984913226421",appId:"1:984913226421:web:c648bbccdd5055cf6cecfc",measurementId:"G-95WJ280TC9"}),u=(0,s.xI)(d),p=(0,n.aU)(d);(0,c.C3)(d);let g=(0,o.c7)(d);(0,i.Uz)(d);try{(0,l.TT)().then(e=>{e?((0,l.P5)(d),console.log("\uD83D\uDCCA Firebase Analytics enabled")):console.log("ℹ️ Firebase Analytics not supported in this environment")}).catch(()=>{console.warn("Analytics check failed; continuing without Analytics")})}catch(e){console.warn("Analytics initialization skipped:",e)}console.log("\uD83D\uDE80 Using production Firebase configuration for project:",d.options.projectId)},90389:(e,t,r)=>{r.d(t,{Em:()=>u,Ff:()=>y,Kk:()=>w,Kv:()=>l,N4:()=>p,d5:()=>h,ee:()=>g,kl:()=>o,n1:()=>m,zo:()=>c});var a=r(35317),s=r(25610),n=r(95997);let o=e=>{if(!(0,n.HW)())return console.error("User not authenticated for admin stats subscription"),()=>{};let t=async()=>{try{let t=await i();e(t)}catch(e){console.error("Error fetching admin stats:",e)}};t();let r=setInterval(t,3e4);return()=>clearInterval(r)},i=async()=>{try{let e=(0,n.HW)();if(!e)throw Error("User not authenticated");if(!await (0,n.qc)(e.uid))throw Error("User is not an admin");console.log("✅ Admin verification passed, fetching stats...");let t=[];try{let e=(0,a.query)((0,a.collection)(s.db,"users"));t=(await (0,a.getDocs)(e)).docs.map(e=>Object.assign({id:e.id},e.data()))}catch(e){console.error("Error fetching users:",e)}let r={normal:t.filter(e=>"user"===e.role).length,personal:t.filter(e=>"personal_seller"===e.role).length,brand:t.filter(e=>"brand"===e.role).length,company:t.filter(e=>"company"===e.role).length,admin:t.filter(e=>"admin"===e.role).length},o=[];try{let e=(0,a.query)((0,a.collection)(s.db,"products"));o=(await (0,a.getDocs)(e)).docs.map(e=>Object.assign({id:e.id},e.data()))}catch(e){console.error("Error fetching products:",e)}let i={approved:o.filter(e=>"active"===e.status).length,pending:o.filter(e=>"pending"===e.status).length,rejected:o.filter(e=>"rejected"===e.status).length},c=[];try{let e=(0,a.query)((0,a.collection)(s.db,"orders"));c=(await (0,a.getDocs)(e)).docs.map(e=>Object.assign({id:e.id},e.data()))}catch(e){console.error("Error fetching orders:",e)}let l={pending:c.filter(e=>"pending"===e.status).length,paid:c.filter(e=>"paid"===e.paymentStatus&&"delivered"!==e.status).length,shipped:c.filter(e=>"shipped"===e.status).length,delivered:c.filter(e=>"delivered"===e.status).length,refunded:c.filter(e=>"refunded"===e.status).length},d=0;try{let e=(0,a.query)((0,a.collection)(s.db,"users"),(0,a.where)("role","in",["personal_seller","brand","company"]));d=(await (0,a.getDocs)(e)).size}catch(e){console.error("Error fetching applications:",e)}let u=c.filter(e=>"delivered"===e.status&&"paid"===e.paymentStatus).reduce((e,t)=>e+t.total,0),p=new Date,g=new Date(p.getTime()-864e5),y=new Date(p.getTime()-6048e5),m=new Date(p.getTime()-2592e6),h=c.filter(e=>e.createdAt>=g&&"delivered"===e.status&&"paid"===e.paymentStatus).reduce((e,t)=>e+t.total,0),w=c.filter(e=>e.createdAt>=y&&"delivered"===e.status&&"paid"===e.paymentStatus).reduce((e,t)=>e+t.total,0),f=c.filter(e=>e.createdAt>=m&&"delivered"===e.status&&"paid"===e.paymentStatus).reduce((e,t)=>e+t.total,0),b={totalUsers:t.length,totalProducts:o.length,totalOrders:c.length,totalRevenue:u,pendingApplications:d,pendingProducts:i.pending,monthlyGrowth:18.5,revenueAnalytics:{today:h,week7d:w,month30d:f},userRoles:r,orderStatus:l,productStatus:i};return console.log("✅ Admin stats fetched successfully:",b),b}catch(e){if(console.error("❌ Error getting admin stats:",e),"permission-denied"===e.code)throw Error("Missing or insufficient permissions. Please ensure you are logged in as an admin.");throw e}},c=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,o=(0,n.HW)();if(!o)return console.error("User not authenticated"),()=>{};(0,n.qc)(o.uid).then(n=>{if(!n)return console.error("User is not an admin"),()=>{};let o=(0,a.query)((0,a.collection)(s.db,"orders"),(0,a.My)("createdAt","desc"),(0,a.AB)(r));return e.status&&"all"!==e.status&&(o=(0,a.query)(o,(0,a.where)("status","==",e.status))),e.paymentStatus&&"all"!==e.paymentStatus&&(o=(0,a.query)(o,(0,a.where)("paymentStatus","==",e.paymentStatus))),(0,a.onSnapshot)(o,async r=>{try{let n=r.docs.map(e=>Object.assign({id:e.id},e.data())),o=(0,a.query)((0,a.collection)(s.db,"users")),i=(await (0,a.getDocs)(o)).docs.map(e=>Object.assign({id:e.id},e.data())),c=n.map(e=>{var t,r;let a=i.find(t=>t.id===e.userId);return{id:e.id,buyerName:(null==a?void 0:a.name)||(null==a?void 0:a.displayName)||"Unknown",buyerId:e.userId||"",sellerName:"Unknown",sellerId:"",total:e.total,status:e.status,paymentStatus:e.paymentStatus,createdAt:e.createdAt,paymentMethod:e.paymentMethod,productName:(null==(r=null==(t=e.items[0])?void 0:t.product)?void 0:r.title)||"Unknown",buyerEmail:(null==a?void 0:a.email)||"",sellerEmail:"",itemsCount:e.items.length,currency:e.currency,country:""}}),l=c;if(e.search){let t=e.search.toLowerCase();l=c.filter(e=>(e.buyerName||"").toLowerCase().includes(t)||(e.sellerName||"").toLowerCase().includes(t)||(e.id||"").toLowerCase().includes(t))}t(l)}catch(e){console.error("Error getting orders analytics:",e),"permission-denied"===e.code?console.error("Missing or insufficient permissions. Please ensure you are logged in as an admin."):"failed-precondition"===e.code&&console.error("Missing index. Please create the required composite index for this query.")}})}).catch(e=>(console.error("Error checking admin status:",e),()=>{}))},l=async(e,t,r)=>{try{let n=(0,a.doc)(s.db,"orders",e);await (0,a.mZ)(n,Object.assign({status:t,updatedAt:a.Dc.now()},r)),await d({action:"UPDATE_ORDER_STATUS_".concat(t.toUpperCase()),targetType:"order",targetId:e,details:Object.assign({status:t},r)})}catch(e){throw console.error("Error updating order status:",e),e}},d=async e=>{try{let t=(0,a.doc)((0,a.collection)(s.db,"auditLogs"));await (0,a.mZ)(t,{id:t.id,actorId:"admin",actorName:"Admin",action:e.action,targetType:e.targetType,targetId:e.targetId,timestamp:a.Dc.now(),ip:"127.0.0.1",userAgent:"Admin Dashboard",details:e.details})}catch(e){console.error("Error adding audit log:",e)}},u=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;if(!(0,n.HW)())return console.error("User not authenticated for audit logs subscription"),()=>{};let o=(0,a.query)((0,a.collection)(s.db,"auditLogs"),(0,a.My)("timestamp","desc"),(0,a.AB)(r));return(0,a.onSnapshot)(o,e=>{try{let r=e.docs.map(e=>Object.assign(Object.assign({id:e.id},e.data()),{timestamp:e.data().timestamp.toDate()}));t(r)}catch(e){console.error("Error getting audit logs:",e)}})},p=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,n=(0,a.query)((0,a.collection)(s.db,"payments"),(0,a.My)("requestedAt","desc"),(0,a.AB)(r));return e.status&&"all"!==e.status&&(n=(0,a.query)(n,(0,a.where)("status","==",e.status))),(0,a.onSnapshot)(n,async r=>{try{let a=r.docs.map(e=>Object.assign({id:e.id},e.data())).map(e=>({id:e.id,sellerId:e.sellerId,sellerName:e.sellerName||"Unknown",amount:e.amount,status:e.status,requestedAt:e.requestedAt,processedAt:e.processedAt,transactionId:e.transactionId,notes:e.notes,currency:e.currency||"USD"})),s=a;if(e.search){let t=e.search.toLowerCase();s=a.filter(e=>e.sellerName.toLowerCase().includes(t)||e.id.toLowerCase().includes(t))}t(s)}catch(e){console.error("Error getting payments analytics:",e)}})},g=async(e,t,r)=>{try{let n=(0,a.doc)(s.db,"payments",e);await (0,a.mZ)(n,Object.assign(Object.assign({status:t,processedAt:"paid"===t?a.Dc.now():null},r),{updatedAt:a.Dc.now()})),await d({action:"".concat(t.toUpperCase(),"_PAYMENT"),targetType:"payment",targetId:e,details:Object.assign({status:t},r)})}catch(e){throw console.error("Error updating payment status:",e),e}},y=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,n=(0,a.query)((0,a.collection)(s.db,"reviews"),(0,a.My)("createdAt","desc"),(0,a.AB)(r));return e.status&&"all"!==e.status&&(n=(0,a.query)(n,(0,a.where)("status","==",e.status))),e.rating&&"all"!==e.rating&&(n=(0,a.query)(n,(0,a.where)("rating","==",parseInt(e.rating)))),(0,a.onSnapshot)(n,async r=>{try{let a=r.docs.map(e=>Object.assign({id:e.id},e.data())).map(e=>({id:e.id,productId:e.productId,productName:e.productName||"Unknown",userId:e.userId,userName:e.userName||"Unknown",rating:e.rating,review:e.review,createdAt:e.createdAt,reportCount:e.reportCount||0,status:e.status||"active"})),s=a;if(e.search){let t=e.search.toLowerCase();s=a.filter(e=>e.productName.toLowerCase().includes(t)||e.userName.toLowerCase().includes(t))}t(s)}catch(e){console.error("Error getting reviews analytics:",e)}})},m=async(e,t)=>{try{let r=(0,a.doc)(s.db,"reviews",e);await (0,a.mZ)(r,{status:"removed",updatedAt:a.Dc.now()}),await d({action:"REMOVE_REVIEW",targetType:"review",targetId:e,details:t})}catch(e){throw console.error("Error removing review:",e),e}},h=async()=>{try{let e=await (0,a.x7)((0,a.doc)(s.db,"systemSettings","main"));if(e.exists())return e.data();return{categories:[],features:{reels:!0,chat:!0,reviews:!0},adminProtection:!0}}catch(e){throw console.error("Error getting system settings:",e),e}},w=async e=>{try{let t=(0,a.doc)(s.db,"systemSettings","main");await (0,a.mZ)(t,Object.assign(Object.assign({},e),{updatedAt:a.Dc.now()})),await d({action:"UPDATE_SYSTEM_SETTINGS",targetType:"system",targetId:"main",details:e})}catch(e){throw console.error("Error updating system settings:",e),e}}},95997:(e,t,r)=>{r.d(t,{G6:()=>i,HW:()=>u,Hh:()=>l,Jv:()=>c,eT:()=>h,gL:()=>p,qc:()=>m,xw:()=>d});var a=r(16203),s=r(35317),n=r(25610);let o=new a.HF;o.addScope("email"),o.addScope("profile");let i=async()=>{var e;try{let t=(await (0,a.df)(n.j2,o)).user;if(!(await (0,s.x7)((0,s.doc)(n.db,"users",t.uid))).exists()){let r={id:t.uid,email:t.email||"",name:t.displayName||"Anonymous",username:(null==(e=t.email)?void 0:e.split("@")[0])||"user",avatar:t.photoURL||"",role:"user",accountType:"user",isVerified:!1,isVerifiedSeller:!1,isActive:!0,createdAt:new Date,updatedAt:new Date,followersCount:0,followingCount:0,productsCount:0,rating:0,totalSales:0};await (0,s.BN)((0,s.doc)(n.db,"users",t.uid),r)}return t}catch(e){throw console.error("Google sign-in error:",e),e}},c=async(e,t)=>{try{return(await (0,a.x9)(n.j2,e,t)).user}catch(e){throw e}},l=async function(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"user";try{let i=(await (0,a.eJ)(n.j2,e,t)).user;await (0,a.r7)(i,{displayName:r});try{let t={id:i.uid,email:i.email||"",name:r,username:e.split("@")[0],avatar:i.photoURL||"",bio:"",role:o,accountType:o,isVerified:!1,isVerifiedSeller:!1,isActive:!0,createdAt:new Date,updatedAt:new Date,followersCount:0,followingCount:0,productsCount:0,rating:0,totalSales:0};await (0,s.BN)((0,s.doc)(n.db,"users",i.uid),t),console.log("✅ User profile created successfully")}catch(e){console.warn("Could not create user document in Firestore:",e)}return i}catch(e){throw console.error("Signup error:",e),e}},d=async e=>{try{await (0,a.J1)(n.j2,e)}catch(e){throw e}},u=()=>n.j2.currentUser,p=async e=>{try{let t=await (0,s.x7)((0,s.doc)(n.db,"users",e));if(t.exists())return t.data();return null}catch(e){return console.error("Error getting user data:",e),null}},g=async e=>{try{let t=await p(e);return(null==t?void 0:t.role)||"user"}catch(e){return console.error("Error checking user role:",e),"user"}},y=async e=>{try{let t=await p(e);return(null==t?void 0:t.accountType)||"user"}catch(e){return console.error("Error checking account type:",e),"user"}},m=async e=>"admin"===await g(e),h=async e=>["personal_seller","brand","company"].includes(await y(e))}}]);