"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3690],{53690:(e,n,r)=>{r.d(n,{he:()=>b,bA:()=>h,n6:()=>u,wA:()=>f,Jv:()=>v});var t=r(35317),a=r(25610),i=r(49509);let o=async e=>{try{let n=await (0,t.addDoc)((0,t.collection)(a.db,"mail"),{to:e.to,message:{subject:e.subject,html:e.html,text:e.message||"Please view this email in HTML format."},template:{name:e.type,data:{orderId:e.orderId,userId:e.userId,type:e.type}},createdAt:(0,t.serverTimestamp)(),processed:!1});return await (0,t.addDoc)((0,t.collection)(a.db,"emailNotifications"),Object.assign(Object.assign({},e),{createdAt:(0,t.serverTimestamp)(),sent:!1,firebaseEmailId:n.id})),console.log("✅ Email queued for Firebase processing:",e.type),{success:!0,emailId:n.id}}catch(e){return console.error("❌ Error queuing email notification:",e),{success:!1,error:e}}},s=async(e,n,r,t)=>{var a,s;let d="Order Confirmation - #".concat(e.slice(-8).toUpperCase()),c='\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset="utf-8">\n      <title>Order Confirmation</title>\n      <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }\n        .content { background: #f8f9fa; padding: 30px; border-radius: 0 0 10px 10px; }\n        .order-details { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }\n        .item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }\n        .total { font-weight: bold; font-size: 18px; color: #667eea; }\n        .button { display: inline-block; background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; margin: 20px 0; }\n        .footer { text-align: center; color: #666; margin-top: 30px; }\n      </style>\n    </head>\n    <body>\n      <div class="container">\n        <div class="header">\n          <h1>\uD83C\uDF89 Order Confirmed!</h1>\n          <p>Thank you for your purchase</p>\n        </div>\n        \n        <div class="content">\n          <h2>Hi '.concat(t.customerName||"Valued Customer",',</h2>\n          \n          <p>Great news! Your order has been successfully placed and confirmed.</p>\n          \n          <div class="order-details">\n            <h3>\uD83D\uDCE6 Order Details</h3>\n            <div class="item">\n              <span><strong>Order ID:</strong></span>\n              <span>#').concat(e.slice(-8).toUpperCase(),'</span>\n            </div>\n            <div class="item">\n              <span><strong>Order Date:</strong></span>\n              <span>').concat(new Date().toLocaleDateString(),'</span>\n            </div>\n            <div class="item">\n              <span><strong>Total Amount:</strong></span>\n              <span class="total">$').concat((t.totalAmount||t.total||0).toFixed(2),'</span>\n            </div>\n            <div class="item">\n              <span><strong>Payment Method:</strong></span>\n              <span>').concat(t.paymentMethod||"Online Payment",'</span>\n            </div>\n            <div class="item">\n              <span><strong>Shipping Address:</strong></span>\n              <span>').concat((null==(a=t.shippingAddress)?void 0:a.address)||"Address on file",'</span>\n            </div>\n          </div>\n          \n          <h3>\uD83D\uDECD️ Items Ordered</h3>\n          <div class="order-details">\n            ').concat((null==(s=t.items)?void 0:s.map(e=>{var n,r;return'\n              <div class="item">\n                <span>'.concat((null==(n=e.product)?void 0:n.title)||e.title||"Product"," (x").concat(e.quantity||1,")</span>\n                <span>$").concat((((null==(r=e.product)?void 0:r.price)||e.price||0)*(e.quantity||1)).toFixed(2),"</span>\n              </div>\n            ")}).join(""))||'<div class="item"><span>Order items</span><span>$'+(t.totalAmount||t.total||0).toFixed(2)+"</span></div>",'\n          </div>\n          \n          <div style="text-align: center;">\n            <a href="').concat(i.env.NEXT_PUBLIC_APP_URL,"/orders/").concat(e,'" class="button">\n              \uD83D\uDCF1 Track Your Order\n            </a>\n          </div>\n          \n          <h3>\uD83D\uDCCB What\'s Next?</h3>\n          <ul>\n            <li>✅ Your order is being prepared by the seller</li>\n            <li>\uD83D\uDCE6 You\'ll receive shipping updates via email</li>\n            <li>\uD83D\uDE9A Track your package in real-time</li>\n            <li>⭐ Leave a review after delivery</li>\n          </ul>\n          \n          <div class="footer">\n            <p>Questions? Contact us at <a href="mailto:support@goryl.com">support@goryl.com</a></p>\n            <p>\xa9 2024 Goryl Marketplace. All rights reserved.</p>\n          </div>\n        </div>\n      </div>\n    </body>\n    </html>\n  ');return await o({to:n,subject:d,html:c,type:"order_placed",orderId:e,userId:r})},d=async(e,n,r,t)=>{var a,s,d,c,l,p,u;let m="\uD83C\uDF89 New Order Received - #".concat(e.slice(-8).toUpperCase()),g='\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset="utf-8">\n      <title>New Order Notification</title>\n      <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }\n        .content { background: #f0fdf4; padding: 30px; border-radius: 0 0 10px 10px; }\n        .order-details { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #10b981; }\n        .item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }\n        .total { font-weight: bold; font-size: 18px; color: #10b981; }\n        .button { display: inline-block; background: #10b981; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; margin: 20px 0; }\n        .urgent { background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; border-radius: 8px; margin: 20px 0; }\n        .footer { text-align: center; color: #666; margin-top: 30px; }\n      </style>\n    </head>\n    <body>\n      <div class="container">\n        <div class="header">\n          <h1>\uD83D\uDCB0 New Order Alert!</h1>\n          <p>You have a new customer order</p>\n        </div>\n        \n        <div class="content">\n          <h2>Hi '.concat(t.sellerName||"Seller",',</h2>\n          \n          <div class="urgent">\n            <strong>⚡ Action Required:</strong> A new order has been placed and needs your attention!\n          </div>\n          \n          <div class="order-details">\n            <h3>\uD83D\uDCE6 Order Information</h3>\n            <div class="item">\n              <span><strong>Order ID:</strong></span>\n              <span>#').concat(e.slice(-8).toUpperCase(),'</span>\n            </div>\n            <div class="item">\n              <span><strong>Customer:</strong></span>\n              <span>').concat(t.customerName||"Customer",'</span>\n            </div>\n            <div class="item">\n              <span><strong>Order Date:</strong></span>\n              <span>').concat(new Date().toLocaleDateString(),'</span>\n            </div>\n            <div class="item">\n              <span><strong>Order Value:</strong></span>\n              <span class="total">$').concat((t.totalAmount||t.total||0).toFixed(2),'</span>\n            </div>\n            <div class="item">\n              <span><strong>Payment Status:</strong></span>\n              <span style="color: #10b981; font-weight: bold;">✅ PAID</span>\n            </div>\n          </div>\n          \n          <h3>\uD83D\uDECD️ Items to Prepare</h3>\n          <div class="order-details">\n            ').concat((null==(a=t.items)?void 0:a.map(e=>{var n,r;return'\n              <div class="item">\n                <span><strong>'.concat((null==(n=e.product)?void 0:n.title)||e.title||"Product","</strong> (Qty: ").concat(e.quantity||1,")</span>\n                <span>$").concat((((null==(r=e.product)?void 0:r.price)||e.price||0)*(e.quantity||1)).toFixed(2),"</span>\n              </div>\n            ")}).join(""))||'<div class="item"><span>Order items</span><span>$'+(t.totalAmount||t.total||0).toFixed(2)+"</span></div>",'\n          </div>\n          \n          <h3>\uD83D\uDCCD Shipping Details</h3>\n          <div class="order-details">\n            <div class="item">\n              <span><strong>Customer Name:</strong></span>\n              <span>').concat((null==(s=t.shippingAddress)?void 0:s.firstName)||""," ").concat((null==(d=t.shippingAddress)?void 0:d.lastName)||"",'</span>\n            </div>\n            <div class="item">\n              <span><strong>Address:</strong></span>\n              <span>').concat((null==(c=t.shippingAddress)?void 0:c.address)||"Address provided",'</span>\n            </div>\n            <div class="item">\n              <span><strong>City:</strong></span>\n              <span>').concat((null==(l=t.shippingAddress)?void 0:l.city)||"",", ").concat((null==(p=t.shippingAddress)?void 0:p.state)||"",'</span>\n            </div>\n            <div class="item">\n              <span><strong>Phone:</strong></span>\n              <span>').concat((null==(u=t.shippingAddress)?void 0:u.phone)||"Not provided",'</span>\n            </div>\n          </div>\n          \n          <div style="text-align: center;">\n            <a href="').concat(i.env.NEXT_PUBLIC_APP_URL,'/brand/dashboard?tab=orders" class="button">\n              \uD83D\uDE80 Manage Order\n            </a>\n          </div>\n          \n          <h3>\uD83D\uDCCB Next Steps</h3>\n          <ul>\n            <li>✅ Confirm the order in your dashboard</li>\n            <li>\uD83D\uDCE6 Prepare the items for shipping</li>\n            <li>\uD83D\uDE9A Update shipping status</li>\n            <li>\uD83D\uDCB0 Payment will be released after delivery</li>\n          </ul>\n          \n          <div class="footer">\n            <p>Questions? Contact us at <a href="mailto:seller-support@goryl.com">seller-support@goryl.com</a></p>\n            <p>\xa9 2024 Goryl Marketplace. All rights reserved.</p>\n          </div>\n        </div>\n      </div>\n    </body>\n    </html>\n  ');return await o({to:n,subject:m,html:g,type:"new_order_seller",orderId:e,userId:r})},c=async function(e,n,r,t,a){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d={pending:{title:"⏳ Order Pending",message:"Your order is awaiting confirmation",color:"#f59e0b"},confirmed:{title:"✅ Order Confirmed",message:"Your order has been confirmed and is being prepared",color:"#10b981"},processing:{title:"\uD83D\uDCE6 Order Processing",message:"Your order is being processed and packed",color:"#3b82f6"},shipped:{title:"\uD83D\uDE9A Order Shipped",message:"Your order is on its way to you",color:"#8b5cf6"},out_for_delivery:{title:"\uD83D\uDE9B Out for Delivery",message:"Your order will arrive today",color:"#f97316"},delivered:{title:"\uD83D\uDCE6 Order Delivered",message:"Your order has been delivered successfully",color:"#10b981"},cancelled:{title:"❌ Order Cancelled",message:"Your order has been cancelled",color:"#ef4444"}},c=d[t]||d.pending,l="".concat(c.title," - #").concat(e.slice(-8).toUpperCase()),p='\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset="utf-8">\n      <title>Order Status Update</title>\n      <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: '.concat(c.color,"; color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }\n        .content { background: #f8f9fa; padding: 30px; border-radius: 0 0 10px 10px; }\n        .status-update { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid ").concat(c.color,"; }\n        .button { display: inline-block; background: ").concat(c.color,"; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; margin: 20px 0; }\n        .timeline { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }\n        .timeline-item { display: flex; align-items: center; padding: 10px 0; }\n        .timeline-dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 15px; }\n        .active { background: ").concat(c.color,'; }\n        .completed { background: #10b981; }\n        .pending { background: #d1d5db; }\n        .footer { text-align: center; color: #666; margin-top: 30px; }\n      </style>\n    </head>\n    <body>\n      <div class="container">\n        <div class="header">\n          <h1>').concat(c.title,"</h1>\n          <p>Order #").concat(e.slice(-8).toUpperCase(),'</p>\n        </div>\n        \n        <div class="content">\n          <h2>Hi ').concat(s?a.sellerName||"Seller":a.customerName||"Customer",',</h2>\n          \n          <div class="status-update">\n            <h3>\uD83D\uDCCB Status Update</h3>\n            <p><strong>').concat(c.message,"</strong></p>\n            <p>Updated on: ").concat(new Date().toLocaleString(),'</p>\n          </div>\n          \n          <div class="timeline">\n            <h3>\uD83D\uDCCD Order Timeline</h3>\n            <div class="timeline-item">\n              <div class="timeline-dot completed"></div>\n              <span>Order Placed</span>\n            </div>\n            <div class="timeline-item">\n              <div class="timeline-dot ').concat(["confirmed","processing","shipped","out_for_delivery","delivered"].includes(t)?"completed":"pending",'"></div>\n              <span>Order Confirmed</span>\n            </div>\n            <div class="timeline-item">\n              <div class="timeline-dot ').concat(["processing","shipped","out_for_delivery","delivered"].includes(t)?"completed":"processing"===t?"active":"pending",'"></div>\n              <span>Processing</span>\n            </div>\n            <div class="timeline-item">\n              <div class="timeline-dot ').concat(["shipped","out_for_delivery","delivered"].includes(t)?"completed":"shipped"===t?"active":"pending",'"></div>\n              <span>Shipped</span>\n            </div>\n            <div class="timeline-item">\n              <div class="timeline-dot ').concat(["out_for_delivery","delivered"].includes(t)?"completed":"out_for_delivery"===t?"active":"pending",'"></div>\n              <span>Out for Delivery</span>\n            </div>\n            <div class="timeline-item">\n              <div class="timeline-dot ').concat("delivered"===t?"completed":"pending",'"></div>\n              <span>Delivered</span>\n            </div>\n          </div>\n          \n          <div style="text-align: center;">\n            <a href="').concat(i.env.NEXT_PUBLIC_APP_URL,"/orders/").concat(e,'" class="button">\n              \uD83D\uDCF1 Track Order\n            </a>\n          </div>\n          \n          ').concat("delivered"===t?'\n            <div style="background: #f0fdf4; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center;">\n              <h3>\uD83C\uDF89 Order Delivered!</h3>\n              <p>We hope you love your purchase! Please consider leaving a review.</p>\n              <a href="'.concat(i.env.NEXT_PUBLIC_APP_URL,"/orders/").concat(e,'?review=true" style="display: inline-block; background: #10b981; color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px; margin-top: 10px;">\n                ⭐ Leave a Review\n              </a>\n            </div>\n          '):"",'\n          \n          <div class="footer">\n            <p>Questions? Contact us at <a href="mailto:support@goryl.com">support@goryl.com</a></p>\n            <p>\xa9 2024 Goryl Marketplace. All rights reserved.</p>\n          </div>\n        </div>\n      </div>\n    </body>\n    </html>\n  ');return await o({to:n,subject:l,html:p,type:"order_status_update",orderId:e,userId:r})},l=async(e,n)=>{try{console.log("\uD83D\uDCE7 Sending order notifications for order:",e);let r=n.buyerEmail||n.customerEmail,t=n.buyerId||n.customerId,a=n.sellerEmail,i=n.sellerId,o=[];return r&&t&&o.push(s(e,r,t,n)),a&&i&&o.push(d(e,a,i,n)),await Promise.all(o),console.log("✅ All order notifications sent successfully"),{success:!0}}catch(e){return console.error("❌ Error sending order notifications:",e),{success:!1,error:e}}},p=async(e,n,r)=>{try{console.log("\uD83D\uDCF1 Sending real-time notification:",{userId:e,type:n,data:r});let i={userId:e,type:n,title:m(n),message:g(n,r),data:r,read:!1,createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()},o=await (0,t.addDoc)((0,t.collection)(a.db,"notifications"),i);if(console.log("✅ Real-time notification sent:",o.id),"order_placed"===n&&r.orderDetails)await l(r.orderId,r.orderDetails);else if(r.orderId&&r.orderDetails){let i=await (0,t.x7)((0,t.doc)(a.db,"users",e));if(i.exists()){let t=i.data();await c(r.orderId,t.email,e,r.status||n.replace("order_",""),r.orderDetails)}}return{success:!0,notificationId:o.id}}catch(e){return console.error("❌ Error sending real-time notification:",e),{success:!1,error:"Failed to send notification"}}},u=async(e,n)=>{var r;return await p(e,"order_placed",{orderId:n.id,orderNumber:n.id.slice(-8).toUpperCase(),total:n.total,trackingNumber:n.trackingNumber,items:(null==(r=n.items)?void 0:r.length)||0})},m=e=>{switch(e){case"order_placed":return"\uD83C\uDF89 Order Placed Successfully!";case"order_confirmed":return"✅ Order Confirmed";case"order_shipped":return"\uD83D\uDE9A Order Shipped";case"order_delivered":return"\uD83D\uDCE6 Order Delivered";case"order_cancelled":return"❌ Order Cancelled";default:return"\uD83D\uDCF1 Order Update"}},g=(e,n)=>{var r;switch(e){case"order_placed":return"Your order #".concat(n.orderNumber," has been placed successfully! Total: $").concat(null==(r=n.total)?void 0:r.toFixed(2),". Tracking: ").concat(n.trackingNumber);case"order_confirmed":return"Your order #".concat(n.orderNumber," has been confirmed and is being processed.");case"order_shipped":return"Your order #".concat(n.orderNumber," has been shipped! Track it with: ").concat(n.trackingNumber);case"order_delivered":return"Your order #".concat(n.orderNumber," has been delivered successfully!");case"order_cancelled":return"Your order #".concat(n.orderNumber," has been cancelled.");default:return"Your order #".concat(n.orderNumber," status has been updated.")}},v=(e,n)=>{try{console.log("\uD83D\uDCF1 Subscribing to notifications for user:",e);let r=(0,t.query)((0,t.collection)(a.db,"notifications"),(0,t.where)("userId","==",e),(0,t.My)("createdAt","desc"));return(0,t.onSnapshot)(r,e=>{let r=e.docs.map(e=>{var n;return Object.assign(Object.assign({id:e.id},e.data()),{createdAt:(null==(n=e.data().createdAt)?void 0:n.toDate)?e.data().createdAt.toDate():new Date})});console.log("\uD83D\uDCF1 Notifications updated:",r.length),n(r)})}catch(e){return console.error("❌ Error subscribing to notifications:",e),()=>{}}},h=async e=>{try{let n=(0,t.doc)(a.db,"notifications",e);return await (0,t.mZ)(n,{read:!0,updatedAt:(0,t.serverTimestamp)()}),console.log("✅ Notification marked as read:",e),{success:!0}}catch(e){return console.error("❌ Error marking notification as read:",e),{success:!1}}},b=async e=>{try{return console.log("\uD83D\uDCF1 Marking all notifications as read for user:",e),console.log("✅ All notifications marked as read for user:",e),{success:!0}}catch(e){return console.error("❌ Error marking all notifications as read:",e),{success:!1}}},f=async(e,n,r)=>{try{console.log("\uD83D\uDCE7 Sending order status update notifications:",{orderId:e,newStatus:n});let t=[];return(r.buyerId||r.customerId)&&t.push(p(r.buyerId||r.customerId,"order_".concat(n),{orderId:e,orderNumber:e.slice(-8).toUpperCase(),status:n,orderDetails:r})),r.sellerId&&["cancelled","delivered"].includes(n)&&t.push(p(r.sellerId,"order_".concat(n),{orderId:e,orderNumber:e.slice(-8).toUpperCase(),status:n,orderDetails:r,isForSeller:!0})),await Promise.all(t),console.log("✅ Order status update notifications sent successfully"),{success:!0}}catch(e){return console.error("❌ Error sending order status update notifications:",e),{success:!1,error:e}}}}}]);