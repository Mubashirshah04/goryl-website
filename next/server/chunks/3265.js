"use strict";exports.id=3265,exports.ids=[3265],exports.modules={83265:(a,b,c)=>{c.d(b,{Em:()=>l,Ff:()=>o,Kk:()=>r,Kv:()=>j,N4:()=>m,d5:()=>q,ee:()=>n,kl:()=>g,n1:()=>p,zo:()=>i});var d=c(75535),e=c(762),f=c(20597);let g=a=>{if(!(0,f.HW)())return console.error("User not authenticated for admin stats subscription"),()=>{};let b=async()=>{try{let b=await h();a(b)}catch(a){console.error("Error fetching admin stats:",a)}};b();let c=setInterval(b,3e4);return()=>clearInterval(c)},h=async()=>{try{let a=(0,f.HW)();if(!a)throw Error("User not authenticated");if(!await (0,f.qc)(a.uid))throw Error("User is not an admin");console.log("✅ Admin verification passed, fetching stats...");let b=[];try{let a=(0,d.query)((0,d.collection)(e.db,"users"));b=(await (0,d.getDocs)(a)).docs.map(a=>Object.assign({id:a.id},a.data()))}catch(a){console.error("Error fetching users:",a)}let c={normal:b.filter(a=>"user"===a.role).length,personal:b.filter(a=>"personal_seller"===a.role).length,brand:b.filter(a=>"brand"===a.role).length,company:b.filter(a=>"company"===a.role).length,admin:b.filter(a=>"admin"===a.role).length},g=[];try{let a=(0,d.query)((0,d.collection)(e.db,"products"));g=(await (0,d.getDocs)(a)).docs.map(a=>Object.assign({id:a.id},a.data()))}catch(a){console.error("Error fetching products:",a)}let h={approved:g.filter(a=>"active"===a.status).length,pending:g.filter(a=>"pending"===a.status).length,rejected:g.filter(a=>"rejected"===a.status).length},i=[];try{let a=(0,d.query)((0,d.collection)(e.db,"orders"));i=(await (0,d.getDocs)(a)).docs.map(a=>Object.assign({id:a.id},a.data()))}catch(a){console.error("Error fetching orders:",a)}let j={pending:i.filter(a=>"pending"===a.status).length,paid:i.filter(a=>"paid"===a.paymentStatus&&"delivered"!==a.status).length,shipped:i.filter(a=>"shipped"===a.status).length,delivered:i.filter(a=>"delivered"===a.status).length,refunded:i.filter(a=>"refunded"===a.status).length},k=0;try{let a=(0,d.query)((0,d.collection)(e.db,"users"),(0,d.where)("role","in",["personal_seller","brand","company"]));k=(await (0,d.getDocs)(a)).size}catch(a){console.error("Error fetching applications:",a)}let l=i.filter(a=>"delivered"===a.status&&"paid"===a.paymentStatus).reduce((a,b)=>a+b.total,0),m=new Date,n=new Date(m.getTime()-864e5),o=new Date(m.getTime()-6048e5),p=new Date(m.getTime()-2592e6),q=i.filter(a=>a.createdAt>=n&&"delivered"===a.status&&"paid"===a.paymentStatus).reduce((a,b)=>a+b.total,0),r=i.filter(a=>a.createdAt>=o&&"delivered"===a.status&&"paid"===a.paymentStatus).reduce((a,b)=>a+b.total,0),s=i.filter(a=>a.createdAt>=p&&"delivered"===a.status&&"paid"===a.paymentStatus).reduce((a,b)=>a+b.total,0),t={totalUsers:b.length,totalProducts:g.length,totalOrders:i.length,totalRevenue:l,pendingApplications:k,pendingProducts:h.pending,monthlyGrowth:18.5,revenueAnalytics:{today:q,week7d:r,month30d:s},userRoles:c,orderStatus:j,productStatus:h};return console.log("✅ Admin stats fetched successfully:",t),t}catch(a){if(console.error("❌ Error getting admin stats:",a),"permission-denied"===a.code)throw Error("Missing or insufficient permissions. Please ensure you are logged in as an admin.");throw a}},i=(a,b,c=20)=>{let g=(0,f.HW)();if(!g)return console.error("User not authenticated"),()=>{};(0,f.qc)(g.uid).then(f=>{if(!f)return console.error("User is not an admin"),()=>{};let g=(0,d.query)((0,d.collection)(e.db,"orders"),(0,d.My)("createdAt","desc"),(0,d.AB)(c));return a.status&&"all"!==a.status&&(g=(0,d.query)(g,(0,d.where)("status","==",a.status))),a.paymentStatus&&"all"!==a.paymentStatus&&(g=(0,d.query)(g,(0,d.where)("paymentStatus","==",a.paymentStatus))),(0,d.onSnapshot)(g,async c=>{try{let f=c.docs.map(a=>Object.assign({id:a.id},a.data())),g=(0,d.query)((0,d.collection)(e.db,"users")),h=(await (0,d.getDocs)(g)).docs.map(a=>Object.assign({id:a.id},a.data())),i=f.map(a=>{var b,c;let d=h.find(b=>b.id===a.userId);return{id:a.id,buyerName:(null==d?void 0:d.name)||(null==d?void 0:d.displayName)||"Unknown",buyerId:a.userId||"",sellerName:"Unknown",sellerId:"",total:a.total,status:a.status,paymentStatus:a.paymentStatus,createdAt:a.createdAt,paymentMethod:a.paymentMethod,productName:(null==(c=null==(b=a.items[0])?void 0:b.product)?void 0:c.title)||"Unknown",buyerEmail:(null==d?void 0:d.email)||"",sellerEmail:"",itemsCount:a.items.length,currency:a.currency,country:""}}),j=i;if(a.search){let b=a.search.toLowerCase();j=i.filter(a=>(a.buyerName||"").toLowerCase().includes(b)||(a.sellerName||"").toLowerCase().includes(b)||(a.id||"").toLowerCase().includes(b))}b(j)}catch(a){console.error("Error getting orders analytics:",a),"permission-denied"===a.code?console.error("Missing or insufficient permissions. Please ensure you are logged in as an admin."):"failed-precondition"===a.code&&console.error("Missing index. Please create the required composite index for this query.")}})}).catch(a=>(console.error("Error checking admin status:",a),()=>{}))},j=async(a,b,c)=>{try{let f=(0,d.doc)(e.db,"orders",a);await (0,d.mZ)(f,Object.assign({status:b,updatedAt:d.Dc.now()},c)),await k({action:`UPDATE_ORDER_STATUS_${b.toUpperCase()}`,targetType:"order",targetId:a,details:Object.assign({status:b},c)})}catch(a){throw console.error("Error updating order status:",a),a}},k=async a=>{try{let b=(0,d.doc)((0,d.collection)(e.db,"auditLogs"));await (0,d.mZ)(b,{id:b.id,actorId:"admin",actorName:"Admin",action:a.action,targetType:a.targetType,targetId:a.targetId,timestamp:d.Dc.now(),ip:"127.0.0.1",userAgent:"Admin Dashboard",details:a.details})}catch(a){console.error("Error adding audit log:",a)}},l=(a,b,c=50)=>{if(!(0,f.HW)())return console.error("User not authenticated for audit logs subscription"),()=>{};let g=(0,d.query)((0,d.collection)(e.db,"auditLogs"),(0,d.My)("timestamp","desc"),(0,d.AB)(c));return(0,d.onSnapshot)(g,a=>{try{let c=a.docs.map(a=>Object.assign(Object.assign({id:a.id},a.data()),{timestamp:a.data().timestamp.toDate()}));b(c)}catch(a){console.error("Error getting audit logs:",a)}})},m=(a,b,c=20)=>{let f=(0,d.query)((0,d.collection)(e.db,"payments"),(0,d.My)("requestedAt","desc"),(0,d.AB)(c));return a.status&&"all"!==a.status&&(f=(0,d.query)(f,(0,d.where)("status","==",a.status))),(0,d.onSnapshot)(f,async c=>{try{let d=c.docs.map(a=>Object.assign({id:a.id},a.data())).map(a=>({id:a.id,sellerId:a.sellerId,sellerName:a.sellerName||"Unknown",amount:a.amount,status:a.status,requestedAt:a.requestedAt,processedAt:a.processedAt,transactionId:a.transactionId,notes:a.notes,currency:a.currency||"USD"})),e=d;if(a.search){let b=a.search.toLowerCase();e=d.filter(a=>a.sellerName.toLowerCase().includes(b)||a.id.toLowerCase().includes(b))}b(e)}catch(a){console.error("Error getting payments analytics:",a)}})},n=async(a,b,c)=>{try{let f=(0,d.doc)(e.db,"payments",a);await (0,d.mZ)(f,Object.assign(Object.assign({status:b,processedAt:"paid"===b?d.Dc.now():null},c),{updatedAt:d.Dc.now()})),await k({action:`${b.toUpperCase()}_PAYMENT`,targetType:"payment",targetId:a,details:Object.assign({status:b},c)})}catch(a){throw console.error("Error updating payment status:",a),a}},o=(a,b,c=20)=>{let f=(0,d.query)((0,d.collection)(e.db,"reviews"),(0,d.My)("createdAt","desc"),(0,d.AB)(c));return a.status&&"all"!==a.status&&(f=(0,d.query)(f,(0,d.where)("status","==",a.status))),a.rating&&"all"!==a.rating&&(f=(0,d.query)(f,(0,d.where)("rating","==",parseInt(a.rating)))),(0,d.onSnapshot)(f,async c=>{try{let d=c.docs.map(a=>Object.assign({id:a.id},a.data())).map(a=>({id:a.id,productId:a.productId,productName:a.productName||"Unknown",userId:a.userId,userName:a.userName||"Unknown",rating:a.rating,review:a.review,createdAt:a.createdAt,reportCount:a.reportCount||0,status:a.status||"active"})),e=d;if(a.search){let b=a.search.toLowerCase();e=d.filter(a=>a.productName.toLowerCase().includes(b)||a.userName.toLowerCase().includes(b))}b(e)}catch(a){console.error("Error getting reviews analytics:",a)}})},p=async(a,b)=>{try{let c=(0,d.doc)(e.db,"reviews",a);await (0,d.mZ)(c,{status:"removed",updatedAt:d.Dc.now()}),await k({action:"REMOVE_REVIEW",targetType:"review",targetId:a,details:b})}catch(a){throw console.error("Error removing review:",a),a}},q=async()=>{try{let a=await (0,d.x7)((0,d.doc)(e.db,"systemSettings","main"));if(a.exists())return a.data();return{categories:[],features:{reels:!0,chat:!0,reviews:!0},adminProtection:!0}}catch(a){throw console.error("Error getting system settings:",a),a}},r=async a=>{try{let b=(0,d.doc)(e.db,"systemSettings","main");await (0,d.mZ)(b,Object.assign(Object.assign({},a),{updatedAt:d.Dc.now()})),await k({action:"UPDATE_SYSTEM_SETTINGS",targetType:"system",targetId:"main",details:a})}catch(a){throw console.error("Error updating system settings:",a),a}}}};