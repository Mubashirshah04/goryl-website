"use strict";exports.id=39,exports.ids=[39],exports.modules={65657:(a,b,c)=>{c.d(b,{I_:()=>l,TV:()=>n,createProduct:()=>g,d$:()=>k,deleteProduct:()=>j,oo:()=>h,updateProduct:()=>i,vC:()=>m});var d=c(75535),e=c(762),f=c(20597);let g=async a=>{try{if(!await (0,f.eT)(a.sellerId))throw Error("Only approved sellers can create products");let b={id:a.sellerId,name:a.sellerName||"",type:"personal"};try{let c=await (0,d.x7)((0,d.doc)(e.db,"users",a.sellerId));if(c.exists()){let d=c.data();b={id:d.id||a.sellerId,name:d.name||a.sellerName||"",type:d.sellerType||d.role||"personal"}}}catch(a){console.warn("Could not fetch seller info for product creation:",a)}return(await (0,d.addDoc)((0,d.collection)(e.db,"products"),Object.assign(Object.assign({},a),{seller:b,sellerRef:{id:b.id,name:b.name,photoURL:""},likes:[],views:0,rating:0,reviewCount:0,comments:0,status:"active",createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()}))).id}catch(a){throw console.error("Error creating product:",a),a}},h=async a=>{try{let b=(0,d.doc)(e.db,"products",a),c=await (0,d.x7)(b);if(c.exists()){let a=Object.assign({id:c.id},c.data());if(a.sellerId)try{let b=await (0,d.x7)((0,d.doc)(e.db,"users",a.sellerId));if(b.exists()){let c=b.data();a.seller={id:c.id,name:c.name,avatar:c.avatar,isVerified:c.isVerified,rating:c.rating}}}catch(a){console.warn("Could not fetch seller information:",a)}return a}return null}catch(a){throw console.error("Error getting product:",a),a}},i=async(a,b)=>{try{let c=(0,d.doc)(e.db,"products",a);await (0,d.mZ)(c,Object.assign(Object.assign({},b),{updatedAt:(0,d.serverTimestamp)()}))}catch(a){throw console.error("Error updating product:",a),a}},j=async a=>{try{let b=(0,d.doc)(e.db,"products",a);await (0,d.kd)(b)}catch(a){throw console.error("Error deleting product:",a),a}},k=async(a={},b="createdAt",c="desc",f=20)=>{try{let g=(0,d.collection)(e.db,"products"),h=[];a.category&&h.push({field:"category",operator:"==",value:a.category}),a.sellerId&&h.push({field:"sellerId",operator:"==",value:a.sellerId}),a.status?h.push({field:"status",operator:"==",value:a.status}):h.push({field:"status",operator:"==",value:"active"}),void 0!==a.minPrice&&h.push({field:"price",operator:">=",value:a.minPrice}),void 0!==a.maxPrice&&h.push({field:"price",operator:"<=",value:a.maxPrice}),h.forEach(a=>{g=(0,d.query)(g,(0,d.where)(a.field,a.operator,a.value))}),g=(0,d.query)(g,(0,d.My)(b,c)),g=(0,d.query)(g,(0,d.AB)(f));let i=(await (0,d.getDocs)(g)).docs.map(a=>Object.assign({id:a.id},a.data()));if(a.search){let b=a.search.toLowerCase();i=i.filter(a=>{var c;return a.title.toLowerCase().includes(b)||a.description.toLowerCase().includes(b)||(null==(c=a.brand)?void 0:c.toLowerCase().includes(b))})}let j=[...new Set(i.map(a=>a.sellerId))],k=new Map;for(let a of j)try{let b=await (0,d.x7)((0,d.doc)(e.db,"users",a));b.exists()&&k.set(a,b.data())}catch(b){console.warn(`Could not fetch seller ${a}:`,b)}return i.map(a=>{let b=k.get(a.sellerId);return b&&(a.seller={id:b.id,name:b.name,avatar:b.avatar,isVerified:b.isVerified,rating:b.rating}),a})}catch(a){return console.log("Firebase products not accessible, returning empty array"),[]}},l=(a,b={},c="createdAt",f="desc")=>{let g=(0,d.collection)(e.db,"products"),h=[];return b.category&&h.push({field:"category",operator:"==",value:b.category}),b.sellerId&&h.push({field:"sellerId",operator:"==",value:b.sellerId}),b.status&&h.push({field:"status",operator:"==",value:b.status}),void 0!==b.minPrice&&h.push({field:"price",operator:">=",value:b.minPrice}),void 0!==b.maxPrice&&h.push({field:"price",operator:"<=",value:b.maxPrice}),h.forEach(a=>{g=(0,d.query)(g,(0,d.where)(a.field,a.operator,a.value))}),g=(0,d.query)(g,(0,d.My)(c,f)),(0,d.onSnapshot)(g,async c=>{console.log("Products found:",c.docs.length);let f=c.docs.map(a=>Object.assign({id:a.id},a.data()));if(b.search){let a=b.search.toLowerCase();f=f.filter(b=>{var c;return b.title.toLowerCase().includes(a)||b.description.toLowerCase().includes(a)||(null==(c=b.brand)?void 0:c.toLowerCase().includes(a))})}let g=[...new Set(f.map(a=>a.sellerId))],h=new Map;for(let a of g)try{let b=await (0,d.x7)((0,d.doc)(e.db,"users",a));b.exists()&&h.set(a,b.data())}catch(b){console.warn(`Could not fetch seller ${a}:`,b)}a(f.map(a=>{let b=h.get(a.sellerId);return b&&(a.seller={id:b.id,name:b.name,avatar:b.avatar,isVerified:b.isVerified,rating:b.rating}),a}))},b=>{console.error("Firestore error:",b.message),a([])})},m=async(a,b)=>{try{let c=await h(a);if(!c)throw Error("Product not found");let d=c.likes||[];d.includes(b)?await i(a,{likes:d.filter(a=>a!==b)}):await i(a,{likes:[...d,b]})}catch(a){throw console.error("Error toggling product like:",a),a}},n=async a=>k({sellerId:a})},69727:(a,b,c)=>{c.d(b,{H:()=>i,K:()=>k,Qk:()=>g,Yn:()=>l,gx:()=>m,mQ:()=>o,pX:()=>n,vf:()=>f,vv:()=>j,zT:()=>h});var d=c(75535),e=c(762);let f=async a=>{try{return(await (0,d.addDoc)((0,d.collection)(e.db,"reels"),Object.assign(Object.assign({},a),{likesCount:0,commentsCount:0,sharesCount:0,viewsCount:0,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()}))).id}catch(a){throw console.error("Error creating reel:",a),a}},g=async(a,b)=>{try{let c=(0,d.doc)(e.db,"reels",a);await (0,d.mZ)(c,{likesCount:(0,d.GV)(1),likedBy:(0,d.hq)(b),updatedAt:(0,d.serverTimestamp)()})}catch(a){throw console.error("Error liking reel:",a),a}},h=async(a,b)=>{try{let c=(0,d.doc)(e.db,"reels",a);await (0,d.mZ)(c,{likesCount:(0,d.GV)(-1),likedBy:(0,d.C3)(b),updatedAt:(0,d.serverTimestamp)()})}catch(a){throw console.error("Error unliking reel:",a),a}},i=a=>{let b=(0,d.query)((0,d.collection)(e.db,"reels"),(0,d.My)("createdAt","desc"));return(0,d.onSnapshot)(b,b=>{a(b.docs.map(a=>Object.assign({id:a.id},a.data())))},b=>{console.log("Reels not accessible, returning empty array"),a([])})},j=async(a,b,c,f,g)=>{try{let h=await (0,d.addDoc)((0,d.collection)(e.db,"reels",a,"comments"),{userId:b,userName:c,userPhotoURL:f,text:g,content:g,likesCount:0,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()}),i=(0,d.doc)(e.db,"reels",a);return await (0,d.mZ)(i,{commentsCount:(0,d.GV)(1),updatedAt:(0,d.serverTimestamp)()}),h.id}catch(a){throw console.error("Error adding reel comment:",a),a}},k=(a,b)=>{let c=(0,d.query)((0,d.collection)(e.db,"reels",a,"comments"),(0,d.My)("createdAt","desc"));return(0,d.onSnapshot)(c,a=>{b(a.docs.map(a=>{let b=a.data();return{id:a.id,userId:b.userId,userName:b.userName,userPhotoURL:b.userPhotoURL||b.userPhoto,text:b.text||b.content,likesCount:b.likesCount||0,createdAt:b.createdAt,updatedAt:b.updatedAt}}))},a=>{console.log("Reel comments not accessible, returning empty array"),b([])})},l=async(a,b)=>{try{let c=(0,d.doc)(e.db,"reels",a);await (0,d.mZ)(c,{sharesCount:(0,d.GV)(1),sharedBy:(0,d.hq)(b),updatedAt:(0,d.serverTimestamp)()})}catch(a){throw console.error("Error sharing reel:",a),a}},m=async(a,b)=>{try{let c=(0,d.doc)(e.db,"users",b,"savedReels",a);await (0,d.BN)(c,{reelId:a,savedAt:(0,d.serverTimestamp)()})}catch(a){throw console.error("Error saving reel:",a),a}},n=async(a,b)=>{try{let c=(0,d.doc)(e.db,"users",b,"savedReels",a);await (0,d.kd)(c)}catch(a){throw console.error("Error unsaving reel:",a),a}},o=async(a,b)=>{try{let c=(0,d.doc)(e.db,"users",b,"savedReels",a);return(await (0,d.x7)(c)).exists()}catch(a){return console.error("Error checking if reel is saved:",a),!1}}}};